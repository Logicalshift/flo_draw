use flo_render_software::draw::*;
use flo_render_software::edges::*;
use flo_render_software::pixel::*;
use flo_render_software::render::*;
use flo_render_software::scanplan::*;
use flo_render_software::edgeplan::*;

use flo_render_software::curves::geo::*;
use flo_render_software::curves::bezier::*;
use flo_render_software::curves::bezier::path::*;

use flo_render_software::canvas::*;

use smallvec::*;

#[cfg(feature = "render_term")]
fn render_path(path: &BezierSubpath, y_pos: f64) {
    // Get the range of x and y coordinates in this path
    let mut min_x = f64::MAX;
    let mut min_y = f64::MAX;
    let mut max_x = f64::MIN;
    let mut max_y = f64::MIN;

    for curve in path.to_curves::<Curve<_>>() {
        let (sp, (cp1, cp2), ep) = curve.all_points();

        for p in [sp, cp1, cp2, ep] {
            min_x = min_x.min(p.x());
            min_y = min_y.min(p.y());
            max_x = max_x.max(p.x());
            max_y = max_y.max(p.y());
        }
    }

    let width   = max_x - min_x;
    let height  = max_y - min_y;

    let canvas_height = width.max(height);

    // Render the curve
    let mut drawing = vec![];
    drawing.clear_canvas(Color::Rgba(1.0, 1.0, 1.0, 1.0));

    drawing.canvas_height(canvas_height as _);
    drawing.center_region(min_x as _, min_y as _, max_x as _, max_y as _);
    drawing.line_width_pixels(1.0);
    drawing.stroke_color(Color::Rgba(0.0, 0.7, 0.0, 1.0));

    drawing.new_path();
    drawing.move_to(path.start_point().x() as _, path.start_point().y() as _);
    for curve in path.to_curves::<Curve<_>>() {
        println!("  {:?}", control_polygon_length(&curve));
        drawing.bezier_curve(&curve);
    }
    drawing.stroke();

    // Draw the control points
    drawing.stroke_color(Color::Rgba(0.5, 0.5, 0.0, 1.0));
    for curve in path.to_curves::<Curve<_>>() {
        let (sp, (cp1, cp2), ep) = curve.all_points();

        drawing.new_path();
        drawing.move_to(cp2.x() as _, cp2.y() as _);
        drawing.line_to(ep.x() as _, ep.y() as _);
        drawing.move_to(cp1.x() as _, cp1.y() as _);
        drawing.line_to(sp.x() as _, sp.y() as _);
        drawing.stroke();
    }

    // Render the scanline
    drawing.line_width_pixels(2.0);
    drawing.stroke_color(Color::Rgba(0.7, 0.0, 0.0, 0.5));

    drawing.new_path();
    drawing.move_to(min_x as _, y_pos as _);
    drawing.line_to(max_x as _, y_pos as _);
    drawing.stroke();

    // Draw the intercepts
    let intercepts  = path.intercepts_on_line(y_pos).collect::<Vec<_>>();
    drawing.stroke_color(Color::Rgba(0.0, 0.7, 0.7, 1.0));
    for (idx, intercept) in intercepts.into_iter().enumerate() {
        drawing.new_path();
        if idx%2 == 0 {
            drawing.move_to(intercept.x_pos as _, y_pos as _);
            drawing.line_to(intercept.x_pos as _, (y_pos+(canvas_height/270.0)) as _);
        } else {
            drawing.move_to(intercept.x_pos as _, (y_pos-(canvas_height/270.0)) as _);
            drawing.line_to(intercept.x_pos as _, y_pos as _);
        }
        drawing.stroke();
    }

    // Draw to the terminal
    let mut canvas_drawing = CanvasDrawing::<F32LinearPixel, 4>::empty();
    canvas_drawing.draw(drawing.iter().cloned());
    let mut term_renderer = TerminalRenderTarget::new(1920, 1080);

    let renderer = CanvasDrawingRegionRenderer::new(PixelScanPlanner::default(), ScanlineRenderer::new(canvas_drawing.program_runner(1080.0)), 1080);
    term_renderer.render(renderer, &canvas_drawing);
}

#[cfg(not(feature = "render_term"))]
fn render_path(_path: impl BezierPath<Point=Coord2>, _y_pos: f64) {
    // Nothing to do
}

#[test]
pub fn intercepts_1() {
    // Generates an intercept on two consecutive curves where one point is at the end and one is at the beginning (ie, crossing the same edge twice)
    let mut path = BezierPathBuilder::<BezierSubpath>::start(Coord2(-0.2037662266584257, -0.34995458248326766))
        .curve_to((Coord2(-0.20006384207737574, -0.35319049320697476), Coord2(-0.19778599976302993, -0.3576703897326853)), Coord2(-0.19431519023924634, -0.36111487969372347))
        .curve_to((Coord2(-0.19431503462317426, -0.36111503420780017), Coord2(-0.1943148790071022, -0.3611151887218768)), Coord2(-0.19431472334434063, -0.3611153432823124))
        .curve_to((Coord2(-0.18294289255315344, -0.3724123516207334), Coord2(-0.16958474910311086, -0.3835618084981183)), Coord2(-0.15358122129524585, -0.38745096337884))
        .curve_to((Coord2(-0.15358119165293727, -0.3874509705835756), Coord2(-0.15358116201062869, -0.38745097778831117)), Coord2(-0.15358113235942653, -0.3874509849952084))
        .curve_to((Coord2(-0.14395285570388705, -0.3897915520488139), Coord2(-0.13347754501911002, -0.38814846670720726)), Coord2(-0.12368297576904297, -0.38814846670720726))
        .curve_to((Coord2(-0.12368297576904297, -0.38814846670720726), Coord2(-0.12368297576904297, -0.38814846670720726)), Coord2(-0.12368297576904297, -0.38814846670720726))
        .curve_to((Coord2(-0.11573407727766122, -0.38814846670720726), Coord2(-0.10778901214865767, -0.387407625817904)), Coord2(-0.10026765180850696, -0.3845881040578401))
        .curve_to((Coord2(-0.10026771361469485, -0.3845881272323997), Coord2(-0.10026777542088273, -0.38458815040695926)), Coord2(-0.10026783724561433, -0.3845881735884719))
        .curve_to((Coord2(-0.09822388934861571, -0.3838216071313091), Coord2(-0.09396942460443825, -0.3849772284862197)), Coord2(-0.09396942460443825, -0.38279426097869873))
        .curve_to((Coord2(-0.09310145582857077, -0.38279426097869873), Coord2(-0.09223348705270328, -0.38279426097869873)), Coord2(-0.09136525786016136, -0.38279426097869873))
        .curve_to((Coord2(-0.09136525786016136, -0.3851364602855769), Coord2(-0.09784821500867084, -0.38646200322312213)), Coord2(-0.0993533633159091, -0.3870264971650071))
        .curve_to((Coord2(-0.099353425122097, -0.3870265203395667), Coord2(-0.09935348692828488, -0.38702654351412624)), Coord2(-0.09935354875301648, -0.3870265666956389))
        .curve_to((Coord2(-0.10712695885690601, -0.3899405739957303), Coord2(-0.1154278620549664, -0.39075263345148414)), Coord2(-0.12368297576904297, -0.39075263345148414))
        .curve_to((Coord2(-0.12368297576904297, -0.39075263345148414), Coord2(-0.12368297576904297, -0.39075263345148414)), Coord2(-0.12368297576904297, -0.39075263345148414))
        .curve_to((Coord2(-0.13373978674827755, -0.39075263345148414), Coord2(-0.14429743492929809, -0.39238779522746203)), Coord2(-0.15419627242572972, -0.38998145671621737))
        .curve_to((Coord2(-0.15419624278342114, -0.38998146392095295), Coord2(-0.15419621314111256, -0.38998147112568854)), Coord2(-0.1541961834899104, -0.3899814783325858))
        .curve_to((Coord2(-0.17063635371210378, -0.38598621122478494), Coord2(-0.1844484936444886, -0.37458740886243014)), Coord2(-0.19615005937050312, -0.36296283512344935))
        .curve_to((Coord2(-0.19614990375443103, -0.36296298963752605), Coord2(-0.19614974813835898, -0.3629631441516027)), Coord2(-0.1961495924755974, -0.36296329871203825))
        .curve_to((Coord2(-0.19957834020225215, -0.3595605515885026), Coord2(-0.20183200830256534, -0.35510373526121125)), Coord2(-0.20547997962514364, -0.3519153821163417))
        .curve_to((Coord2(-0.20490878576133656, -0.35126184759863815), Coord2(-0.20433759189752945, -0.35060831308093454)), Coord2(-0.2037662266584257, -0.34995458248326766))
        .build();
    let y_pos       = -0.36296296296296293;

    path.prepare_to_render();
    render_path(&path, y_pos);

    // Forward
    let intercepts  = path.intercepts_on_line(y_pos).collect::<Vec<_>>();

    assert!(intercepts.len()%2 == 0, "Uneven number of intercepts ({:?})", intercepts);

    // Reversed
    let mut reversed_path   = path.reversed::<BezierSubpath>();
    reversed_path.prepare_to_render();
    let intercepts          = reversed_path.intercepts_on_line(y_pos).collect::<Vec<_>>();

    assert!(intercepts.len()%2 == 0, "Uneven number of intercepts ({:?})", intercepts);
}

#[test]
pub fn intercepts_2() {
    // Generates a 'phantom' intercept at the end of a curve (or the beginning when reversed)
    let mut path = BezierPathBuilder::<BezierSubpath>::start(Coord2(0.04830430783292097, 0.18478220408954432))
        .curve_to((Coord2(0.04775305741207142, 0.18474116578970692), Coord2(0.047108255651257695, 0.184896668111831)), Coord2(0.04710566286387735, 0.1857024397248586))
        .curve_to((Coord2(0.04709953685697513, 0.18760624506595508), Coord2(0.04518566629694711, 0.18659355370749012)), Coord2(0.047371613815294464, 0.18690131940017693))
        .curve_to((Coord2(0.04805999857232273, 0.18699823902418602), Coord2(0.04688621835651759, 0.1863394738894744)), Coord2(0.046958130521619575, 0.18580241140839857))
        .curve_to((Coord2(0.046978623983972984, 0.18564935983886585), Coord2(0.047202697147652635, 0.18523846238119146)), Coord2(0.04711813765757779, 0.1853676694149549))
        .curve_to((Coord2(0.04744917839863493, 0.18603811688078556), Coord2(0.04778021913969208, 0.1867085643466162)), Coord2(0.04811135920290376, 0.18737921296680204))
        .curve_to((Coord2(0.061453856064071784, 0.1883685208682045), Coord2(0.08128162230430418, 0.18421937405070374)), Coord2(0.09369413525003352, 0.183377219869547))
        .curve_to((Coord2(0.0936941125118948, 0.18337722141166612), Coord2(0.09369408977375607, 0.18337722295378528)), Coord2(0.09369406702879522, 0.1833772244963671))
        .curve_to((Coord2(0.1494579717454884, 0.1795967418723746), Coord2(0.20397410481953976, 0.1757020895902669)), Coord2(0.25443942116792356, 0.1497018024698814))
        .curve_to((Coord2(0.25443944815676656, 0.14970178856373742), Coord2(0.25443947514560955, 0.14970177465759343)), Coord2(0.25443950214255, 0.14970176074727717))
        .curve_to((Coord2(0.2931375718497182, 0.12976066278047257), Coord2(0.32561322727808956, 0.11016885452238281)), Coord2(0.35781021183649225, 0.08040410175703806))
        .curve_to((Coord2(0.35781020016103304, 0.08040411255011047), Coord2(0.35781018848557383, 0.08040412334318288)), Coord2(0.35781017680661165, 0.08040413413949353))
        .curve_to((Coord2(0.39878730814693303, 0.042525290613385), Coord2(0.39616959264358376, 0.0014014265212860047)), Coord2(0.36429153340681547, -0.042695181677015706))
        .curve_to((Coord2(0.3642915425337018, -0.0426951690514057), Coord2(0.3642915516605881, -0.042695156425795695)), Coord2(0.3642915607902127, -0.042695143796397626))
        .curve_to((Coord2(0.3378413564517431, -0.07928621979187947), Coord2(0.2994869074200185, -0.0841373178925148)), Coord2(0.2568932636157139, -0.08603785156364893))
        .curve_to((Coord2(0.2568932677685678, -0.08603785137832815), Coord2(0.25689327192142175, -0.08603785119300736)), Coord2(0.25689327607552165, -0.08603785100763098))
        .curve_to((Coord2(0.2169983418556795, -0.08781835082308456), Coord2(0.17404684180184707, -0.07230945852060967)), Coord2(0.1363459219842503, -0.09079412177143933))
        .curve_to((Coord2(0.1363459216094387, -0.09079412195520827), Coord2(0.1363459212346271, -0.0907941221389772)), Coord2(0.13634592085970307, -0.09079412232280126))
        .curve_to((Coord2(0.11257541141850796, -0.10244871311863818), Coord2(0.09482888368212143, -0.11404953840723703)), Coord2(0.08062436520590005, -0.13678368744045952))
        .curve_to((Coord2(0.08069024991852852, -0.13656032640092725), Coord2(0.080756134631157, -0.13633696536139497)), Coord2(0.080822039111176, -0.13611353730684936))
        .curve_to((Coord2(0.08056648429735028, -0.15291596701745994), Coord2(0.07716416249479166, -0.1720553688703618)), Coord2(0.07344866818896795, -0.18775563138715226))
        .curve_to((Coord2(0.07344868514567862, -0.18775555970741403), Coord2(0.07344870210238931, -0.1877554880276758)), Coord2(0.07344871906418751, -0.1877554163264315))
        .curve_to((Coord2(0.06774291989639819, -0.21188422190087075), Coord2(0.0572820703309524, -0.23379223451538925)), Coord2(0.045187080505062586, -0.2553583260473919))
        .curve_to((Coord2(0.04492210895244345, -0.25472717290624464), Coord2(0.044657137399824326, -0.2540960197650973)), Coord2(0.04439208634778947, -0.25346467725907124))
        .curve_to((Coord2(0.10407511590266101, -0.2696437586974074), Coord2(0.1671958785082951, -0.28589698960944365)), Coord2(0.22880675916681875, -0.29010459371812597))
        .curve_to((Coord2(0.22880674242298576, -0.2901045925749613), Coord2(0.22880672567915278, -0.2901045914317966)), Coord2(0.22880670893029614, -0.290104590288289))
        .curve_to((Coord2(0.30526936743915745, -0.2953234991051694), Coord2(0.3776421634762258, -0.28701683364343367)), Coord2(0.43945482063222163, -0.23658747966734522))
        .curve_to((Coord2(0.4394548190657692, -0.23658748094532875), Coord2(0.43945481749931686, -0.23658748222331227)), Coord2(0.4394548159323945, -0.23658748350167924))
        .curve_to((Coord2(0.47666662699194173, -0.20622824115388505), Coord2(0.5134325886015868, -0.17706586220960924)), Coord2(0.5469555783966724, -0.14252552996364537))
        .curve_to((Coord2(0.5476124580837631, -0.14309046832233363), Coord2(0.5482693377708538, -0.14365540668102192)), Coord2(0.5489264145415591, -0.14422051453816764))
        .curve_to((Coord2(0.525490681500776, -0.17504052889416707), Coord2(0.43894399686036145, -0.2963526502595239)), Coord2(0.46571497804037065, -0.32723570428950477))
        .curve_to((Coord2(0.46571497619135255, -0.327235702156488), Coord2(0.4657149743423344, -0.32723570002347124)), Coord2(0.4657149724927615, -0.32723569788981455))
        .curve_to((Coord2(0.502039397871176, -0.3691390723369004), Coord2(0.6284395667774408, -0.3910143165007122)), Coord2(0.6834711849797692, -0.3842726805694856))
        .curve_to((Coord2(0.6834712033368351, -0.3842726783210544), Coord2(0.683471221693901, -0.3842726760726232)), Coord2(0.6834712400564744, -0.38427267382351743))
        .curve_to((Coord2(0.7545236703438621, -0.3755714852594173), Coord2(0.8310403614225664, -0.3781814664391251)), Coord2(0.8996854995635354, -0.35620005687498707))
        .curve_to((Coord2(0.9001196487810639, -0.35692523241912505), Coord2(0.9005537979985924, -0.35765040796326303)), Coord2(0.9009880774739119, -0.35837580108182165))
        .curve_to((Coord2(0.8693471236028033, -0.38899559448108456), Coord2(0.7961397516538384, -0.46029623991725416)), Coord2(0.7949962930640049, -0.5005552299861984))
        .curve_to((Coord2(0.7949962937747264, -0.5005552049375724), Coord2(0.7949962944854478, -0.5005551798889465)), Coord2(0.7949962951963826, -0.5005551548328052))
        .curve_to((Coord2(0.7939472291247998, -0.5375660668182808), Coord2(0.8306685836352373, -0.5698858631430167)), Coord2(0.8648535974162831, -0.5762852824437503))
        .curve_to((Coord2(0.8648264763086747, -0.5771426254804123), Coord2(0.8647993552010663, -0.5779999685170742)), Coord2(0.864772225956312, -0.57885756878237))
        .curve_to((Coord2(0.8103426487213273, -0.585520676778849), Coord2(0.6948280678465354, -0.6065911877251298)), Coord2(0.6602292516873166, -0.6541463154938396))
        .curve_to((Coord2(0.6599772740340916, -0.6543135464096747), Coord2(0.6597252963808665, -0.6544807773255096)), Coord2(0.6594732431267855, -0.6546480584156368))
        .curve_to((Coord2(0.5301859486256069, -0.6849249561241347), Coord2(0.40060732740624816, -0.7187009659121055)), Coord2(0.27055058647144836, -0.7451509901409635))
        .curve_to((Coord2(0.2705505293832394, -0.7451510017471714), Coord2(0.27055047229503054, -0.7451510133533794)), Coord2(0.2705504151896934, -0.7451510249630695))
        .curve_to((Coord2(0.25447257090838504, -0.7484185763083551), Coord2(0.23766126817262465, -0.7524924678125607)), Coord2(0.22119141413485927, -0.7500536863578466))
        .curve_to((Coord2(0.2211914249826578, -0.7500536879639995), Coord2(0.22119143583045636, -0.7500536895701524)), Coord2(0.22119144668150958, -0.7500536911767871))
        .curve_to((Coord2(0.20871007314343276, -0.7482058281627852), Coord2(0.17066152545843136, -0.7234883362029476)), Coord2(0.1675768523101797, -0.7216766601941275))
        .curve_to((Coord2(0.1357629920570597, -0.7029918904961765), Coord2(0.10323137962250004, -0.6789299112573037)), Coord2(0.06922860267016259, -0.6643583329074529))
        .curve_to((Coord2(0.0692286403566702, -0.6643583490555532), Coord2(0.06922867804317781, -0.6643583652036534)), Coord2(0.0692287157409925, -0.6643583813565986))
        .curve_to((Coord2(0.029497852283182954, -0.6473365267444678), Coord2(-0.010685373803079046, -0.6167843544224662)), Coord2(-0.04711195051463018, -0.593561104568563))
        .curve_to((Coord2(-0.08329831865679749, -0.5704909962977416), Coord2(-0.12382394367958394, -0.547957830015622)), Coord2(-0.15730768052612912, -0.5210990611276297))
        .curve_to((Coord2(-0.15730768181511545, -0.5210990600936735), Coord2(-0.15730768310410181, -0.5210990590597171)), Coord2(-0.1573076843934749, -0.5210990580254506))
        .curve_to((Coord2(-0.17013097057595308, -0.5108128594343228), Coord2(-0.17152986910550627, -0.5107170719094313)), Coord2(-0.17368869039792995, -0.4933402096482356))
        .curve_to((Coord2(-0.17347946886515025, -0.4936599358757195), Coord2(-0.17327024733237056, -0.4939796621032034)), Coord2(-0.17306096302685378, -0.4942994842581483))
        .curve_to((Coord2(-0.17924278541317423, -0.4906315778615523), Coord2(-0.1855286042226207, -0.48565993473235314)), Coord2(-0.19074046090571983, -0.48100501044448596))
        .curve_to((Coord2(-0.19074036161300809, -0.4810050990995336), Coord2(-0.19074026232029637, -0.4810051877545813)), Coord2(-0.19074016299779384, -0.4810052764362281))
        .curve_to((Coord2(-0.19347911409076007, -0.4785605160042861), Coord2(-0.1943692310548377, -0.4740633722665993)), Coord2(-0.19417837114153993, -0.4705875084132356))
        .curve_to((Coord2(-0.19417837000174307, -0.4705874876647875), Coord2(-0.19417836886194617, -0.47058746691633935)), Coord2(-0.19417836772180733, -0.4705874461616661))
        .curve_to((Coord2(-0.1933648174768294, -0.4557843440183825), Coord2(-0.19410369107176784, -0.44090651684994625)), Coord2(-0.1931568831152069, -0.42610961422647065))
        .curve_to((Coord2(-0.19315687843080895, -0.42610954111460825), Coord2(-0.19315687374641102, -0.42610946800274585)), Coord2(-0.1931568690606076, -0.4261093948689477))
        .curve_to((Coord2(-0.19277156817516458, -0.4201037454882433), Coord2(-0.18957335965451155, -0.4170695830297568)), Coord2(-0.18361555177638633, -0.41607763167143946))
        .curve_to((Coord2(-0.18361581501847898, -0.41607767558339137), Coord2(-0.18361607826057164, -0.41607771949534333)), Coord2(-0.1836163415816448, -0.41607776342047015))
        .curve_to((Coord2(-0.16007525267396988, -0.41214338611248585), Coord2(-0.13570173186731274, -0.4065554693888276)), Coord2(-0.11281741369745088, -0.40020884443546656))
        .curve_to((Coord2(-0.11280320122292721, -0.4002051605477014), Coord2(-0.11278898874840354, -0.40020147665993616)), Coord2(-0.1127747720097111, -0.4001977916668941))
        .curve_to((Coord2(-0.11118144266042612, -0.3998134403857673), Coord2(-0.11609154071294113, -0.40105161980248255)), Coord2(-0.11767346861682339, -0.4006227510235823))
        .curve_to((Coord2(-0.12242952129324516, -0.39939152555089164), Coord2(-0.12718557396966695, -0.398160300078201)), Coord2(-0.13208574945446513, -0.39689176474270155))
        .curve_to((Coord2(-0.13208575653182997, -0.39689176305990204), Coord2(-0.13208576360919477, -0.3968917613771026)), Coord2(-0.13208577068868302, -0.3968917596937982))
        .curve_to((Coord2(-0.13988720065685065, -0.39503672866344597), Coord2(-0.14776171545066685, -0.39353190298491736)), Coord2(-0.15557214995487417, -0.39172971439890036))
        .curve_to((Coord2(-0.15557205404064933, -0.3917297365188023), Coord2(-0.15557195812642446, -0.39172975863870424)), Coord2(-0.15557186218342248, -0.3917297807652428))
        .curve_to((Coord2(-0.16886502987353755, -0.38866567543295544), Coord2(-0.18245330772369261, -0.3868341489197685)), Coord2(-0.19586792151623592, -0.3844063353837223))
        .curve_to((Coord2(-0.19535721413325643, -0.3839571485723587), Coord2(-0.19484650675027695, -0.38350796176099505)), Coord2(-0.19433564613975982, -0.38305864018011104))
        .curve_to((Coord2(-0.19240312490687767, -0.4208902925672512), Coord2(-0.19096200360052523, -0.4633878150985893)), Coord2(-0.19802070850069153, -0.5007599223150101))
        .curve_to((Coord2(-0.19802070852243842, -0.5007599224301482), Coord2(-0.19802070854418527, -0.5007599225452862)), Coord2(-0.19802070856593867, -0.5007599226604589))
        .curve_to((Coord2(-0.20430007519053717, -0.5340057968876095), Coord2(-0.2115998128907672, -0.5641868149355649)), Coord2(-0.2287433011869886, -0.5941057055879899))
        .curve_to((Coord2(-0.22874330465603573, -0.5941057116420733), Coord2(-0.22874330812508287, -0.5941057176961567)), Coord2(-0.22874331159517083, -0.5941057237520565))
        .curve_to((Coord2(-0.2339451619519899, -0.6031836773601684), Coord2(-0.2401656775064488, -0.6110348098572872)), Coord2(-0.24725557794111944, -0.6187949649130179))
        .curve_to((Coord2(-0.24714494964443104, -0.6184516541319478), Coord2(-0.2470343213477426, -0.6181083433508778)), Coord2(-0.24692365985924603, -0.617764929566273))
        .curve_to((Coord2(-0.2453020818419603, -0.6315818001933311), Coord2(-0.25034290940417797, -0.6485606687971385)), Coord2(-0.25685823238119015, -0.6601335918496337))
        .curve_to((Coord2(-0.25685831710953083, -0.6601337422793937), Coord2(-0.25685840183787156, -0.6601338927091538)), Coord2(-0.2568584865916333, -0.6601340431840472))
        .curve_to((Coord2(-0.26032418995336304, -0.6662843168752395), Coord2(-0.26737979206848367, -0.6707568228012976)), Coord2(-0.27325562378823126, -0.6740788507600503))
        .curve_to((Coord2(-0.27325569102611175, -0.6740788887665382), Coord2(-0.27325575826399223, -0.6740789267730262)), Coord2(-0.2732558255220461, -0.6740789647909172))
        .curve_to((Coord2(-0.2903186483880956, -0.6837217921076468), Coord2(-0.3061177911482532, -0.6911974803051123)), Coord2(-0.3262021646440091, -0.6935691595146339))
        .curve_to((Coord2(-0.32620219175328424, -0.6935691627149898), Coord2(-0.32620221886255935, -0.6935691659153457)), Coord2(-0.3262022459799681, -0.6935691691166617))
        .curve_to((Coord2(-0.3320907797646019, -0.6942641457599226), Coord2(-0.33571320653706666, -0.6905217626192256)), Coord2(-0.34013105399229726, -0.6873258050454955))
        .curve_to((Coord2(-0.3399154935626527, -0.6874064284419132), Coord2(-0.33969993313300817, -0.687487051838331)), Coord2(-0.3394843080287673, -0.6875676994241866))
        .curve_to((Coord2(-0.3442536724788304, -0.6871394733499983), Coord2(-0.3492965725015014, -0.6863991665674404)), Coord2(-0.3538714120591543, -0.6850819917222997))
        .curve_to((Coord2(-0.35387148920787564, -0.6850819695021305), Coord2(-0.353871566356597, -0.6850819472819615)), Coord2(-0.3538716435284653, -0.6850819250551257))
        .curve_to((Coord2(-0.3604653743584556, -0.683182155760265), Coord2(-0.3635950421496493, -0.6762231460543389)), Coord2(-0.3679951160263366, -0.6716357296379323))
        .curve_to((Coord2(-0.36769553276506156, -0.6717690889615989), Coord2(-0.36739594950378657, -0.6719024482852656)), Coord2(-0.36709627635854475, -0.6720358476207304))
        .curve_to((Coord2(-0.37970731540610886, -0.6716399097421001), Coord2(-0.39541194542768726, -0.6674346387482262)), Coord2(-0.40547898007742933, -0.6605706279993407))
        .curve_to((Coord2(-0.40498060530593566, -0.6605640277594749), Coord2(-0.40448223053444193, -0.660557427519609)), Coord2(-0.40398370623556407, -0.6605508252994732))
        .curve_to((Coord2(-0.4130122928927301, -0.6670636126960474), Coord2(-0.42765250977517355, -0.6713674580943397)), Coord2(-0.4375507828633876, -0.6730085107280503))
        .curve_to((Coord2(-0.43789779803014867, -0.672245485208743), Coord2(-0.4382448131969097, -0.6714824596894359)), Coord2(-0.43859193247863226, -0.6707192052395797))
        .curve_to((Coord2(-0.43160919973710304, -0.6649636092061962), Coord2(-0.42342421363902755, -0.654309465617609)), Coord2(-0.4243897114746496, -0.6449566597373988))
        .curve_to((Coord2(-0.42385548804505113, -0.6453337942348999), Coord2(-0.42332126461545266, -0.6457109287324009)), Coord2(-0.42278688090279704, -0.6460881763815663))
        .curve_to((Coord2(-0.43491148237474103, -0.6490361925633295), Coord2(-0.45011555848747364, -0.6466382061197017)), Coord2(-0.4604887151145573, -0.6397924887285806))
        .curve_to((Coord2(-0.460168529901072, -0.6390039408464941), Coord2(-0.45984834468758673, -0.6382153929644077)), Coord2(-0.4595280634089309, -0.6374266084942977))
        .curve_to((Coord2(-0.4505643416392682, -0.639132640374762), Coord2(-0.43299763036588385, -0.6392873827734057)), Coord2(-0.43048279004046747, -0.6274329744261168))
        .curve_to((Coord2(-0.43011441371325154, -0.6279533725577835), Coord2(-0.4297460373860357, -0.6284737706894501)), Coord2(-0.4293775505348692, -0.6289943249561698))
        .curve_to((Coord2(-0.4423856668911791, -0.6272967266092785), Coord2(-0.45727452485028486, -0.6176363900264691)), Coord2(-0.46560731727217075, -0.6090446005921567))
        .curve_to((Coord2(-0.4650520629686616, -0.6083833733378511), Coord2(-0.46449680866515247, -0.6077221460835454)), Coord2(-0.463941387768693, -0.6070607204412246))
        .curve_to((Coord2(-0.4564412084687521, -0.6121513035521134), Coord2(-0.445556836161493, -0.6127463634571938)), Coord2(-0.43686767992210285, -0.6105426003418278))
        .curve_to((Coord2(-0.43710854726380743, -0.6112231626270974), Coord2(-0.43734941460551197, -0.611903724912367)), Coord2(-0.4375903542146458, -0.6125844913867411))
        .curve_to((Coord2(-0.4464369689240967, -0.6007539866099317), Coord2(-0.45563673019713014, -0.5872276615385156)), Coord2(-0.4617877798941202, -0.5740264876820789))
        .curve_to((Coord2(-0.4617877579480796, -0.574026534774562), Coord2(-0.46178773600203904, -0.5740265818670452)), Coord2(-0.461787714049414, -0.5740266289736575))
        .curve_to((Coord2(-0.4667340895456877, -0.563414204781934), Coord2(-0.47119534076490227, -0.5515553148903267)), Coord2(-0.4718450462878686, -0.539761759923842))
        .curve_to((Coord2(-0.4718450497271828, -0.5397616974107814), Coord2(-0.47184505316649694, -0.5397616348977209)), Coord2(-0.471845056606843, -0.5397615723659045))
        .curve_to((Coord2(-0.4722429685913259, -0.5325195908072826), Coord2(-0.4698515719726604, -0.5216182993306682)), Coord2(-0.4614952638405281, -0.5194255145366099))
        .curve_to((Coord2(-0.46149531486984224, -0.5194255279305641), Coord2(-0.4614953658991564, -0.5194255413245183)), Coord2(-0.4614954169437809, -0.5194255547224911))
        .curve_to((Coord2(-0.43837481140170903, -0.5133554557624939), Coord2(-0.4149947355865806, -0.5129422771848136)), Coord2(-0.3914858958736643, -0.5095549797164171))
        .curve_to((Coord2(-0.3914858275243729, -0.5095549698737836), Coord2(-0.3914857591750815, -0.50955496003115)), Coord2(-0.3914856908052833, -0.5095549501855634))
        .curve_to((Coord2(-0.373861437605408, -0.507018402422627), Coord2(-0.35863916764377607, -0.5019073461284561)), Coord2(-0.348374244921852, -0.48569159009972773))
        .curve_to((Coord2(-0.3483742894211297, -0.48569166041126777), Coord2(-0.34837433392040734, -0.48569173072280775)), Coord2(-0.34837437843303615, -0.48569180105544335))
        .curve_to((Coord2(-0.33607961365486827, -0.4662612099521314), Coord2(-0.33027884298036975, -0.4504130458818353)), Coord2(-0.32900408732757214, -0.4263919791953682))
        .curve_to((Coord2(-0.32900408743917053, -0.4263919812983875), Coord2(-0.329004087550769, -0.4263919834014068)), Coord2(-0.32900408766240086, -0.4263919855050571))
        .curve_to((Coord2(-0.32777134168126215, -0.40316040461764885), Coord2(-0.32887422805142924, -0.38620833524936876)), Coord2(-0.3350704483380249, -0.3632085080632738))
        .curve_to((Coord2(-0.3350704482814964, -0.36320850827310264), Coord2(-0.33507044822496784, -0.3632085084829314)), Coord2(-0.33507044816842235, -0.3632085086928232))
        .curve_to((Coord2(-0.3404441788187304, -0.3432617307878805), Coord2(-0.34516410907823686, -0.32339121555490274)), Coord2(-0.3497674790913827, -0.3032431465799343))
        .curve_to((Coord2(-0.3497674900261728, -0.30324309870797966), Coord2(-0.3497675009609629, -0.3032430508360251)), Coord2(-0.3497675118990337, -0.30324300294970746))
        .curve_to((Coord2(-0.3561752924767932, -0.2751827531273233), Coord2(-0.35011128494165655, -0.23764066389002547)), Coord2(-0.3361753370214078, -0.21303546828445735))
        .curve_to((Coord2(-0.3361753187903156, -0.2130354360989889), Coord2(-0.3361753005592234, -0.21303540391352047)), Coord2(-0.3361752823226613, -0.2130353717183954))
        .curve_to((Coord2(-0.3245285601789377, -0.19247610104043672), Coord2(-0.30892894460249276, -0.17737729904659566)), Coord2(-0.29062029222011665, -0.16253033101819353))
        .curve_to((Coord2(-0.29065610087545635, -0.16256283870786042), Coord2(-0.29069190953079604, -0.16259534639752732)), Coord2(-0.2907277289298067, -0.16262786384047642))
        .curve_to((Coord2(-0.285385264567556, -0.15720500579346247), Coord2(-0.2825754404268986, -0.1472327010736283)), Coord2(-0.28253716239331533, -0.1402948781625039))
        .curve_to((Coord2(-0.28253716195453493, -0.14029479991302377), Coord2(-0.28253716151575453, -0.1402947216635436)), Coord2(-0.2825371610768425, -0.14029464339058625))
        .curve_to((Coord2(-0.2824534857474992, -0.12560860557967082), Coord2(-0.28395672116920356, -0.11093756323899466)), Coord2(-0.28375836247544284, -0.09626107087685555))
        .curve_to((Coord2(-0.2837583624762339, -0.0962610709353871), Coord2(-0.28375836247702496, -0.09626107099391866)), Coord2(-0.2837583624778163, -0.09626107105246777))
        .curve_to((Coord2(-0.28369533343502146, -0.0915975270389443), Coord2(-0.28137863666696306, -0.07921933252613068)), Coord2(-0.28668556275352386, -0.07666256357652143))
        .curve_to((Coord2(-0.28668563480693815, -0.07666252885447206), Coord2(-0.2866857068603525, -0.0766624941324227)), Coord2(-0.286685778935385, -0.07666245939995567))
        .curve_to((Coord2(-0.2927203132125929, -0.07375377320588063), Coord2(-0.3002874926440943, -0.07604740781225874)), Coord2(-0.30614645185911504, -0.07819390806836274))
        .curve_to((Coord2(-0.3061465127192579, -0.07819393036005443), Coord2(-0.30614657357940084, -0.07819395265174611)), Coord2(-0.3061466344578036, -0.07819397495012598))
        .curve_to((Coord2(-0.31442080435662384, -0.08122391521801407), Coord2(-0.325319187197768, -0.07996532255907199)), Coord2(-0.33084709189690226, -0.07238428350816538))
        .curve_to((Coord2(-0.3308470477477577, -0.07238434404388826), Coord2(-0.3308470035986131, -0.07238440457961112)), Coord2(-0.33084695943622244, -0.07238446513349653))
        .curve_to((Coord2(-0.33604110996314907, -0.06526372350231134), Coord2(-0.34010515412982295, -0.05930101276700389)), Coord2(-0.3443817445633945, -0.051187907062843714))
        .curve_to((Coord2(-0.34438172538971246, -0.051187943432996486), Coord2(-0.3443817062160305, -0.05118797980314926)), Coord2(-0.3443816870365958, -0.05118801618421416))
        .curve_to((Coord2(-0.34800555005836414, -0.04431477613589913), Coord2(-0.35147826154737594, -0.03328038232591019)), Coord2(-0.3392899920880557, -0.03342462752458974))
        .curve_to((Coord2(-0.33929006771373865, -0.03342462663616881), Coord2(-0.33929014333942165, -0.033424625747747884)), Coord2(-0.33929021898779455, -0.0334246248590604))
        .curve_to((Coord2(-0.3324699982899178, -0.03350415177804161), Coord2(-0.3316038678843187, -0.03096351987168461)), Coord2(-0.32888461985025713, -0.025112683582586136))
        .curve_to((Coord2(-0.32857845391187973, -0.02487049900223291), Coord2(-0.32827228797350233, -0.024628314421879686)), Coord2(-0.32796603017615755, -0.02438605717888609))
        .curve_to((Coord2(-0.32032279888989473, -0.022814776459960436), Coord2(-0.3123190644087382, -0.021115483152500707)), Coord2(-0.3045918539393648, -0.020385943651386365))
        .curve_to((Coord2(-0.3045918270029984, -0.02038594110912388), Coord2(-0.30459180006663206, -0.020385938566861394)), Coord2(-0.304591773122184, -0.020385936023836156))
        .curve_to((Coord2(-0.2951801460400376, -0.019497959773867233), Coord2(-0.2875377151749962, -0.023692636493057848)), Coord2(-0.2787840062702256, -0.024363188634729464))
        .curve_to((Coord2(-0.2787840097529209, -0.024363188367961926), Coord2(-0.2787840132356162, -0.024363188101194387)), Coord2(-0.27878401671935643, -0.02436318783434681))
        .curve_to((Coord2(-0.27135258729832995, -0.02493239048027951), Coord2(-0.2641479746128612, -0.018021368152691803)), Coord2(-0.2553839605820488, -0.0191672461770081))
        .curve_to((Coord2(-0.25538385609917424, -0.019167259850845105), Coord2(-0.25538375161629967, -0.019167273524682112)), Coord2(-0.25538364710207706, -0.019167287202621678))
        .curve_to((Coord2(-0.24335181628584351, -0.020743397435227993), Coord2(-0.23333357670901828, -0.023532350977018262)), Coord2(-0.2230323766031341, -0.030381855788685616))
        .curve_to((Coord2(-0.22350511515881585, -0.0303767567060968), Coord2(-0.2239778537144976, -0.030371657623507985)), Coord2(-0.22445073410592964, -0.030366557011041406))
        .curve_to((Coord2(-0.21707376686305388, -0.025687721557623333), Coord2(-0.20444730034624814, -0.02405237942421601)), Coord2(-0.1968596791312324, -0.024054686249805647))
        .curve_to((Coord2(-0.19685974511227855, -0.0240546862347615), Coord2(-0.1968598110933247, -0.024054686219717354)), Coord2(-0.19685987709416713, -0.024054686204668694))
        .curve_to((Coord2(-0.16503507550267868, -0.02405952323503901), Coord2(-0.13345439970382014, -0.01879292542717179)), Coord2(-0.10145701896146177, -0.019161588897986928))
        .curve_to((Coord2(-0.1014570201728703, -0.01916158888403116), Coord2(-0.10145702138427883, -0.019161588870075397)), Coord2(-0.10145702259605081, -0.019161588856115443))
        .curve_to((Coord2(-0.07496724619645193, -0.019466721533884984), Coord2(-0.04851020645040126, -0.020022069197037792)), Coord2(-0.02202231333626434, -0.01915695120542056))
        .curve_to((Coord2(-0.022022274770701497, -0.019156949947551488), Coord2(-0.022022236205138653, -0.019156948689682412)), Coord2(-0.02202219762800498, -0.01915694743143594))
        .curve_to((Coord2(-0.009025716466459006, -0.01873362763605788), Coord2(0.007589822944535684, -0.009348002351974131)), Coord2(0.019003829612958042, -0.015651901511607492))
        .curve_to((Coord2(0.0190037348056888, -0.015651849165460387), Coord2(0.01900363999841956, -0.015651796819313283)), Coord2(0.019003545162705294, -0.015651744457460762))
        .curve_to((Coord2(0.028274589938387724, -0.02076907759435429), Coord2(0.03155118007834313, -0.03038104514766102)), Coord2(0.04390671959780377, -0.028948782542427786))
        .curve_to((Coord2(0.04390671098660553, -0.028948783540730945), Coord2(0.04390670237540729, -0.028948784539034107)), Coord2(0.04390669376162543, -0.028948785537636787))
        .curve_to((Coord2(0.05969055540167474, -0.027118789962346908), Coord2(0.07124458566509852, -0.015194879003201467)), Coord2(0.08809789952585663, -0.015492324084853711))
        .curve_to((Coord2(0.0880979661750942, -0.015492325266270084), Coord2(0.08809803282433179, -0.015492326447686456)), Coord2(0.08809809949356613, -0.015492327629457289))
        .curve_to((Coord2(0.11681087485470731, -0.016003492660906785), Coord2(0.14579215536224968, -0.026526297946487275)), Coord2(0.17469296662083908, -0.021622567919560336))
        .curve_to((Coord2(0.1746929223605256, -0.021622575431761035), Coord2(0.17469287810021214, -0.02162258294396173)), Coord2(0.17469283382661926, -0.021622590458416312))
        .curve_to((Coord2(0.20274293034964402, -0.016860219792022648), Coord2(0.2362596943046789, -0.009813384069721959)), Coord2(0.2611011996834778, 0.003915648021770118))
        .curve_to((Coord2(0.2611011998966664, 0.003915648139591945), Coord2(0.26110120010985505, 0.003915648257413771)), Coord2(0.26110120032310763, 0.003915648375270948))
        .curve_to((Coord2(0.27524051312180037, 0.01172994218923339), Coord2(0.30114681898271967, 0.030580663096320754)), Coord2(0.29956138215350137, 0.04913137973390702))
        .curve_to((Coord2(0.2995613779601377, 0.04913142883203966), Coord2(0.299561373766774, 0.04913147793017229)), Coord2(0.2995613695721522, 0.04913152704303584))
        .curve_to((Coord2(0.29761943684584435, 0.071883942732699), Coord2(0.23309762889968547, 0.09544186139177309)), Coord2(0.22097568096510614, 0.09936807087445013))
        .curve_to((Coord2(0.22097569264510358, 0.09936806709156769), Coord2(0.22097570432510102, 0.09936806330868525)), Coord2(0.22097571600860283, 0.09936805952466783))
        .curve_to((Coord2(0.1859093074490767, 0.11072471440632295), Coord2(0.15111772538047524, 0.1239655671467915)), Coord2(0.1145212163569266, 0.12979223668105463))
        .curve_to((Coord2(0.11452121657384559, 0.12979223664651818), Coord2(0.1145212167907646, 0.12979223661198175)), Coord2(0.11452121700774869, 0.12979223657743494))
        .curve_to((Coord2(0.08693302912315509, 0.13418464268902328), Coord2(0.06817542836494878, 0.13142548486693204)), Coord2(0.040735584520251146, 0.12381042373225612))
        .curve_to((Coord2(0.04097626192707589, 0.12398144722737765), Coord2(0.04121693933390064, 0.1241524707224992)), Coord2(0.04145768895116847, 0.12432354552980049))
        .curve_to((Coord2(0.030006946501876106, 0.10779625245756137), Coord2(0.012543207029159377, 0.08977723652942689)), Coord2(-0.004199413528566749, 0.07991964684577295))
        .curve_to((Coord2(-0.004199385070568512, 0.07991966360250959), Coord2(-0.0041993566125702745, 0.07991968035924622)), Coord2(-0.004199328146033784, 0.0799196971210104))
        .curve_to((Coord2(-0.026239890157896035, 0.06694056801013805), Coord2(-0.04960383674203918, 0.06142183234545187)), Coord2(-0.07480856218578523, 0.06631030453329029))
        .curve_to((Coord2(-0.07484741368143938, 0.06715298412367866), Coord2(-0.07488626517709353, 0.06799566371406705)), Coord2(-0.07492512832936203, 0.06883859613361547))
        .curve_to((Coord2(-0.05444003711767106, 0.07481168501467807), Coord2(-0.008755130491084354, 0.08870924572816666)), Coord2(0.0013176289731370566, 0.1085351070307719))
        .curve_to((Coord2(0.0019565081659220075, 0.10798518393539029), Coord2(0.0025953873587069584, 0.10743526084000868)), Coord2(0.003234458234418038, 0.1068851727511991))
        .curve_to((Coord2(-0.01738898673594936, 0.09217889061572959), Coord2(-0.04989278940258928, 0.0748456392322912)), Coord2(-0.07602790625845746, 0.07976205500213693))
        .curve_to((Coord2(-0.07602785863349935, 0.07976204604590591), Coord2(-0.07602781100854124, 0.07976203708967489)), Coord2(-0.07602776336929422, 0.07976202813075672))
        .curve_to((Coord2(-0.09199072867109587, 0.08276306089242878), Coord2(-0.1050078709817549, 0.09089515751292515)), Coord2(-0.1191873354263379, 0.09822882955763274))
        .curve_to((Coord2(-0.11900397805546578, 0.09904799691416326), Coord2(-0.11882062068459366, 0.09986716427069378)), Coord2(-0.11863720830100902, 0.10068657740200875))
        .curve_to((Coord2(-0.09164619515726116, 0.10168319541965568), Coord2(-0.0488584960292649, 0.10133219927103672)), Coord2(-0.02503594871297994, 0.11398581660293511))
        .curve_to((Coord2(-0.024738264850234462, 0.11317888523916347), Coord2(-0.024440580987488986, 0.11237195387539183)), Coord2(-0.024142807810653276, 0.11156478040800069))
        .curve_to((Coord2(-0.04411500834480189, 0.10712849862131091), Coord2(-0.07264151443346942, 0.1058471127383989)), Coord2(-0.0911216338855724, 0.11659846933279976))
        .curve_to((Coord2(-0.09112163525886365, 0.11659847013175596), Coord2(-0.09112163663215489, 0.11659847093071217)), Coord2(-0.09112163800585817, 0.11659847172990809))
        .curve_to((Coord2(-0.11253534526443759, 0.12905663480798635), Coord2(-0.13067128809937412, 0.14602295342343188)), Coord2(-0.15449018581155693, 0.15440447582239258))
        .curve_to((Coord2(-0.15449022564626796, 0.154404489841824), Coord2(-0.15449026548097902, 0.15440450386125545)), Coord2(-0.15449030532764166, 0.15440451788489312))
        .curve_to((Coord2(-0.16598917643511582, 0.15845206028023714), Coord2(-0.17885661796788985, 0.15848296017839492)), Coord2(-0.19082138931505643, 0.159229100958346))
        .curve_to((Coord2(-0.19094215815408583, 0.16007029225740693), Coord2(-0.1910629269931152, 0.1609114835564679)), Coord2(-0.19118373206641973, 0.16175292723815682))
        .curve_to((Coord2(-0.17761502979444663, 0.16666701799332576), Coord2(-0.15742115173402974, 0.16677330639018562)), Coord2(-0.14425885860266102, 0.16672391773455567))
        .curve_to((Coord2(-0.14425882358605294, 0.16672391760175073), Coord2(-0.14425878856944482, 0.16672391746894577)), Coord2(-0.1442587535423307, 0.16672391733610098))
        .curve_to((Coord2(-0.12845241285670303, 0.16666333208124226), Coord2(-0.11586107188250341, 0.16754415567648412)), Coord2(-0.1000773626581924, 0.16548910690230198))
        .curve_to((Coord2(-0.10055312304086529, 0.16494843437005483), Coord2(-0.10102888342353819, 0.1644077618378077)), Coord2(-0.10150478654860012, 0.16386692708757908))
        .curve_to((Coord2(-0.10479428430637706, 0.1763822344908257), Coord2(-0.1329634404517325, 0.18859722903648493)), Coord2(-0.14230757369069033, 0.1923379550628948))
        .curve_to((Coord2(-0.14253201414502314, 0.19293973298496267), Coord2(-0.14275645459935593, 0.19354151090703053)), Coord2(-0.14298096239255892, 0.19414346938053018))
        .curve_to((Coord2(-0.13497429743785358, 0.20967264326209256), Coord2(-0.10553496372293011, 0.20825878423899002)), Coord2(-0.09026280763669604, 0.20583554672672436))
        .curve_to((Coord2(-0.09026278049136892, 0.20583554241868607), Coord2(-0.0902627533460418, 0.20583553811064778)), Coord2(-0.09026272619257025, 0.20583553380131694))
        .curve_to((Coord2(-0.055883081798509975, 0.20037827331441413), Coord2(-0.06289749282254539, 0.19536516668153375)), Coord2(-0.038373794685653835, 0.17872334911556173))
        .curve_to((Coord2(-0.03899628815228827, 0.17815246304955087), Coord2(-0.03961878161892271, 0.17758157698354005)), Coord2(-0.040241461852273806, 0.1770105196345811))
        .curve_to((Coord2(-0.053764360937293525, 0.20119849630045328), Coord2(-0.08135677915921012, 0.22163499050547117)), Coord2(-0.10997199920435026, 0.22037362210184183))
        .curve_to((Coord2(-0.11011965024660476, 0.22122169731061953), Coord2(-0.11026730128885928, 0.22206977251939722)), Coord2(-0.11041499663085644, 0.22291810217618233))
        .curve_to((Coord2(-0.09254110082409117, 0.228460767231195), Coord2(-0.07046722620100862, 0.22958428940963055)), Coord2(-0.052297667056295696, 0.22399714216532693))
        .curve_to((Coord2(-0.05229764406684199, 0.22399713509536273), Coord2(-0.05229762107738828, 0.22399712802539856)), Coord2(-0.052297598081037046, 0.22399712095331317))
        .curve_to((Coord2(-0.033437977263506904, 0.2181966353694333), Coord2(-0.01843064183799966, 0.2104529678553138)), Coord2(-0.000635505499448992, 0.20206304353511))
        .curve_to((Coord2(-0.0011989856266142766, 0.20145801284929402), Coord2(-0.0017624657537795613, 0.20085298216347805)), Coord2(-0.00232611494188909, 0.20024776995030358))
        .curve_to((Coord2(-0.00704251719067996, 0.20864694025905942), Coord2(-0.01613907787947931, 0.21875335533353749)), Coord2(-0.021724984053630415, 0.22501606102424182))
        .curve_to((Coord2(-0.02172499374215421, 0.22501607188701317), Coord2(-0.021725003430678003, 0.22501608274978452)), Coord2(-0.021725013122108647, 0.225016093615815))
        .curve_to((Coord2(-0.027911365934292748, 0.23195246557344254), Coord2(-0.03342790736691862, 0.23884895993457345)), Coord2(-0.04004125820295474, 0.24577253936063317))
        .curve_to((Coord2(-0.039846101252654066, 0.24648974670011117), Coord2(-0.039650944302353386, 0.24720695403958914)), Coord2(-0.03945572879911233, 0.24792437656278735))
        .curve_to((Coord2(-0.02664224594203882, 0.2515668476126523), Coord2(-0.010388305340570092, 0.24529745715931447)), Coord2(-0.000412382675737737, 0.2379356218783263))
        .curve_to((Coord2(-0.0004123991945180194, 0.23793563406792753), Coord2(-0.00041241571329830173, 0.23793564625752878)), Coord2(-0.0004124322370347138, 0.23793565845078726))
        .curve_to((Coord2(0.011130863982756655, 0.22941800703921356), Coord2(0.020678133048338564, 0.21895703135835723)), Coord2(0.030341769416996844, 0.20841912374537794))
        .curve_to((Coord2(0.030341778210031253, 0.2084191141565473), Coord2(0.03034178700306566, 0.20841910456771665)), Coord2(0.030341795798738243, 0.20841909497600908))
        .curve_to((Coord2(0.037254910364993635, 0.2008800957630851), Coord2(0.04332085994119661, 0.19520818800412043)), Coord2(0.04926914826458279, 0.18683476494310042))
        .curve_to((Coord2(0.048561547287294164, 0.18633210138482204), Coord2(0.04785394631000554, 0.18582943782654365)), Coord2(0.047146133031193575, 0.18532662345411638))
        .curve_to((Coord2(0.04139502420686277, 0.19342247635128615), Coord2(0.03516046288340087, 0.1993109947039412)), Coord2(0.028422423485319374, 0.20665906817096358))
        .curve_to((Coord2(0.028422432278353782, 0.20665905858213293), Coord2(0.02842244107138819, 0.20665904899330229)), Coord2(0.028422449867060773, 0.20665903940159472))
        .curve_to((Coord2(0.018897396841391363, 0.21704582600697372), Coord2(0.00943278220720846, 0.22743461929399159)), Coord2(-0.0019586405321303253, 0.23584020519667367))
        .curve_to((Coord2(-0.0019586570509106077, 0.23584021738627492), Coord2(-0.00195867356969089, 0.23584022957587616)), Coord2(-0.0019586900934273023, 0.23584024176913465))
        .curve_to((Coord2(-0.011613332414230428, 0.2429649848982259), Coord2(-0.02660751967711997, 0.24886937674425316)), Coord2(-0.03874365779756736, 0.24541945354585523))
        .curve_to((Coord2(-0.03854850084726669, 0.24613666088533323), Coord2(-0.038353343896966006, 0.2468538682248112)), Coord2(-0.03815812839372495, 0.2475712907480094))
        .curve_to((Coord2(-0.031521076424560694, 0.24062289838191842), Coord2(-0.026018221013760064, 0.23374227269032605)), Coord2(-0.01978151573226147, 0.22674944364614788))
        .curve_to((Coord2(-0.019781525420785265, 0.22674945450891923), Coord2(-0.019781535109309058, 0.22674946537169058)), Coord2(-0.019781544800739702, 0.22674947623772107))
        .curve_to((Coord2(-0.01286715781561615, 0.21899732835527908), Coord2(-0.005156266575970619, 0.21060657665162624)), Coord2(-0.00005544824475641808, 0.20152282178553627))
        .curve_to((Coord2(-0.0006189283719217027, 0.20091779109972027), Coord2(-0.0011824084990869873, 0.2003127604139043)), Coord2(-0.001746057687196516, 0.19970754820072983))
        .curve_to((Coord2(-0.01943787068536068, 0.2080487583672536), Coord2(-0.033801692320489685, 0.21558394681246507)), Coord2(-0.053063148302629946, 0.2215080212586009))
        .curve_to((Coord2(-0.05306312531317624, 0.2215080141886367), Coord2(-0.05306310232372253, 0.22150800711867252)), Coord2(-0.053063079327371296, 0.22150800004658713))
        .curve_to((Coord2(-0.07063371004992221, 0.2269109765437215), Coord2(-0.09221277369063269, 0.22583607807732867)), Coord2(-0.10964368294983204, 0.2204307824063372))
        .curve_to((Coord2(-0.10979133399208654, 0.2212788576151149), Coord2(-0.10993898503434106, 0.2221269328238926)), Coord2(-0.11008668037633822, 0.2229752624806777))
        .curve_to((Coord2(-0.08047452510668116, 0.22428057612011815), Coord2(-0.051973144650880196, 0.2033311350636749)), Coord2(-0.03796841516188635, 0.17828132377972555))
        .curve_to((Coord2(-0.038590908628520784, 0.1777104377137147), Coord2(-0.039213402095155225, 0.17713955164770387)), Coord2(-0.03983608232850632, 0.1765684942987449))
        .curve_to((Coord2(-0.06128845772459948, 0.19112610774292102), Coord2(-0.06039684571030084, 0.19845799556459118)), Coord2(-0.09067098772039361, 0.20326356821894673))
        .curve_to((Coord2(-0.09067096057506649, 0.20326356391090844), Coord2(-0.09067093342973936, 0.20326355960287015)), Coord2(-0.09067090627626782, 0.20326355529353932))
        .curve_to((Coord2(-0.10451207210611987, 0.20545973715960994), Coord2(-0.133387970013423, 0.2070666909880152)), Coord2(-0.1406663364203073, 0.19295007462581748))
        .curve_to((Coord2(-0.1408907768746401, 0.19355185254788534), Coord2(-0.1411152173289729, 0.1941536304699532)), Coord2(-0.14133972512217588, 0.19475558894345285))
        .curve_to((Coord2(-0.12868163825447762, 0.18968819170288898), Coord2(-0.10269009964756316, 0.17862100106487538)), Coord2(-0.09898616498948581, 0.1645289164182803))
        .curve_to((Coord2(-0.0994619253721587, 0.16398824388603314), Coord2(-0.0999376857548316, 0.16344757135378601)), Coord2(-0.10041358887989353, 0.1629067366035574))
        .curve_to((Coord2(-0.1161174485708441, 0.16495138891875014), Coord2(-0.128412337784975, 0.16405899260064322)), Coord2(-0.1442687351661654, 0.16411976972139414))
        .curve_to((Coord2(-0.1442687001495573, 0.1641197695885892), Coord2(-0.1442686651329492, 0.16411976945578424)), Coord2(-0.14426863010583507, 0.16411976932293945))
        .curve_to((Coord2(-0.15852025529258557, 0.16417324546129092), Coord2(-0.17671075705854927, 0.16422482189852644)), Coord2(-0.19029696175071895, 0.15930439240295646))
        .curve_to((Coord2(-0.19041773058974834, 0.1601455837020174), Coord2(-0.1905384994287777, 0.16098677500107836)), Coord2(-0.19065930450208224, 0.16182821868276728))
        .curve_to((Coord2(-0.17830384846795833, 0.16105771422978118), Coord2(-0.16542425614885298, 0.16101399692072443)), Coord2(-0.1536256538398388, 0.156860950712519))
        .curve_to((Coord2(-0.15362569367454984, 0.1568609647319504), Coord2(-0.1536257335092609, 0.15686097875138186)), Coord2(-0.15362577335592353, 0.15686099277501953))
        .curve_to((Coord2(-0.12978074371081078, 0.14847027493033219), Coord2(-0.11137129052729594, 0.13139222888247876)), Coord2(-0.0898120759071057, 0.11884941187604894))
        .curve_to((Coord2(-0.08981207728039695, 0.11884941267500515), Coord2(-0.08981207865368819, 0.11884941347396136)), Coord2(-0.08981208002739147, 0.11884941427315728))
        .curve_to((Coord2(-0.07176767283644256, 0.10835154618592552), Coord2(-0.04456284423561509, 0.10969666025080882)), Coord2(-0.02470749011720317, 0.11410698778047587))
        .curve_to((Coord2(-0.02440980625445769, 0.11330005641670424), Coord2(-0.024112122391712214, 0.11249312505293259)), Coord2(-0.023814349214876504, 0.11168595158554145))
        .curve_to((Coord2(-0.04879302152229283, 0.0984182452970175), Coord2(-0.09068331673384411, 0.09911280742557092)), Coord2(-0.11854111735206715, 0.09808418408785942))
        .curve_to((Coord2(-0.11835775998119503, 0.09890335144438994), Coord2(-0.11817440261032292, 0.09972251880092046)), Coord2(-0.11799099022673827, 0.10054193193223543))
        .curve_to((Coord2(-0.10389212614645561, 0.0932499466974051), Coord2(-0.09167115990806873, 0.08535276988736566)), Coord2(-0.07554660987594504, 0.0823213592441212))
        .curve_to((Coord2(-0.07554656225098694, 0.08232135028789019), Coord2(-0.07554651462602882, 0.08232134133165916)), Coord2(-0.0755464669867818, 0.082321332372741))
        .curve_to((Coord2(-0.05038352533001257, 0.07758779764782275), Coord2(-0.018215330351229256, 0.09478809128044707)), Coord2(0.0017225024436825478, 0.10900547322963586))
        .curve_to((Coord2(0.002361381636467499, 0.10845555013425424), Coord2(0.00300026082925245, 0.10790562703887263)), Coord2(0.0036393317049635294, 0.10735553895006306))
        .curve_to((Coord2(-0.0068934421698987666, 0.08662424731975457), Coord2(-0.052851520643018984, 0.07256225607173243)), Coord2(-0.07419615615550125, 0.06633853933391383))
        .curve_to((Coord2(-0.0742350076511554, 0.0671812189243022), Coord2(-0.07427385914680955, 0.0680238985146906)), Coord2(-0.07431272229907805, 0.06886683093423901))
        .curve_to((Coord2(-0.04979235512700159, 0.06411109045915186), Coord2(-0.02684691636317028, 0.06960525590292994)), Coord2(-0.005520758905357818, 0.08216369025386754))
        .curve_to((Coord2(-0.0055207304473595805, 0.08216370701060417), Coord2(-0.005520701989361343, 0.08216372376734081)), Coord2(-0.005520673522824852, 0.08216374052910498))
        .curve_to((Coord2(0.011846100278435866, 0.09238881429646448), Coord2(0.02785080285452943, 0.10925689427522244)), Coord2(0.039317095136966296, 0.12580663101438896))
        .curve_to((Coord2(0.03955777254379104, 0.1259776545095105), Coord2(0.03979844995061579, 0.12614867800463203)), Coord2(0.04003919956788362, 0.12631975281193333))
        .curve_to((Coord2(0.06714161760654383, 0.13384117208202959), Coord2(0.08722068522035517, 0.1367758105452541)), Coord2(0.11493067775238315, 0.13236401151521643))
        .curve_to((Coord2(0.11493067796930215, 0.13236401148067997), Coord2(0.11493067818622116, 0.13236401144614354)), Coord2(0.11493067840320524, 0.13236401141159673))
        .curve_to((Coord2(0.15158863900146802, 0.1265275579381609), Coord2(0.18664206771258635, 0.11322473420647103)), Coord2(0.2217780758004792, 0.10184553872667494))
        .curve_to((Coord2(0.22177808748047664, 0.1018455349437925), Coord2(0.22177809916047408, 0.10184553116091007)), Coord2(0.2217781108439759, 0.10184552737689265))
        .curve_to((Coord2(0.24085288147363063, 0.09566734993130219), Coord2(0.30009191678879565, 0.07353776688567211)), Coord2(0.30215610250426383, 0.04935298910076299))
        .curve_to((Coord2(0.3021560983109002, 0.049353038198895624), Coord2(0.30215609411753647, 0.04935308729702826)), Coord2(0.30215608992291465, 0.04935313640989181))
        .curve_to((Coord2(0.30385726684912523, 0.02944817991654961), Coord2(0.27666586604406657, 0.00954227341018253)), Coord2(0.26236085679053983, 0.0016364050762671383))
        .curve_to((Coord2(0.26236085700372846, 0.001636405194088965), Coord2(0.2623608572169171, 0.0016364053119107917)), Coord2(0.2623608574301697, 0.0016364054297679685))
        .curve_to((Coord2(0.23707875432944941, -0.012336129628692433), Coord2(0.2029742461597418, -0.019462380154839434)), Coord2(0.17512873370878113, -0.024190016353107125))
        .curve_to((Coord2(0.17512868944846766, -0.024190023865307823), Coord2(0.1751286451881542, -0.024190031377508518)), Coord2(0.1751286009145613, -0.0241900388919631))
        .curve_to((Coord2(0.14607494463307646, -0.029119702818168246), Coord2(0.11687867781779158, -0.0186092791259826)), Coord2(0.08805174562972488, -0.018096081794370836))
        .curve_to((Coord2(0.08805181227896246, -0.018096082975787207), Coord2(0.08805187892820004, -0.018096084157203582)), Coord2(0.08805194559743439, -0.018096085338974412))
        .curve_to((Coord2(0.0720185042099839, -0.01781311023259126), Coord2(0.05973892535211716, -0.029734793215493095)), Coord2(0.044206614191255426, -0.031535623794638604))
        .curve_to((Coord2(0.044206605580057186, -0.03153562479294176), Coord2(0.044206596968858945, -0.03153562579124492)), Coord2(0.04420658835507709, -0.0315356267898476))
        .curve_to((Coord2(0.029806160299547323, -0.03320493427502873), Coord2(0.02887499838974293, -0.024075020255245758)), Coord2(0.017745102527114042, -0.01793165817620623))
        .curve_to((Coord2(0.017745007719844802, -0.017931605830059125), Coord2(0.017744912912575562, -0.01793155348391202)), Coord2(0.017744818076861294, -0.0179315011220595))
        .curve_to((Coord2(0.007771636868881273, -0.012423362703865782), Coord2(-0.011777051200499655, -0.02142879156838976)), Coord2(-0.021937419986741112, -0.021759733858236912))
        .curve_to((Coord2(-0.021937381421178268, -0.02175973260036784), Coord2(-0.021937342855615424, -0.021759731342498763)), Coord2(-0.021937304278481753, -0.02175973008425229))
        .curve_to((Coord2(-0.04846315186746075, -0.022626087702551298), Coord2(-0.07495513170961048, -0.022071200584352607)), Coord2(-0.1014870177024111, -0.021765582851037878))
        .curve_to((Coord2(-0.10148701891381963, -0.02176558283708211), Coord2(-0.10148702012522816, -0.021765582823126347)), Coord2(-0.10148702133700015, -0.021765582809166392))
        .curve_to((Coord2(-0.13340219174108203, -0.021397866539276538), Coord2(-0.16507570761657947, -0.026663683833747107)), Coord2(-0.19686027289972935, -0.026658852918866462))
        .curve_to((Coord2(-0.1968603388807755, -0.026658852903822316), Coord2(-0.19686040486182166, -0.02665885288877817)), Coord2(-0.1968604708626641, -0.02665885287372951))
        .curve_to((Coord2(-0.20500114871267974, -0.026656377905165677), Coord2(-0.21593101605225215, -0.02804672369850537)), Coord2(-0.22305593207754204, -0.03256569587286973))
        .curve_to((Coord2(-0.2235286706332238, -0.032560596790280914), Coord2(-0.22400140918890554, -0.032555497707692095)), Coord2(-0.22447428958033758, -0.03255039709522552))
        .curve_to((Coord2(-0.23422546883061512, -0.02606661379738867), Coord2(-0.24403977918249845, -0.023279692773229176)), Coord2(-0.2557218903124737, -0.021749394087051174))
        .curve_to((Coord2(-0.25572178582959915, -0.021749407760888177), Coord2(-0.25572168134672457, -0.021749421434725184)), Coord2(-0.25572157683250196, -0.02174943511266475))
        .curve_to((Coord2(-0.26451721097575986, -0.020599422819296585), Coord2(-0.2712341772652086, -0.02755325439619027)), Coord2(-0.27898289764831935, -0.02695974917737194))
        .curve_to((Coord2(-0.27898290113101465, -0.026959748910604403), Coord2(-0.27898290461370995, -0.026959748643836864)), Coord2(-0.2789829080974502, -0.026959748376989286))
        .curve_to((Coord2(-0.2874295105739952, -0.026312721220601975), Coord2(-0.2951095045285056, -0.02210702665633715)), Coord2(-0.30434715929663925, -0.022978588817472438))
        .curve_to((Coord2(-0.3043471323602729, -0.022978586275209954), Coord2(-0.3043471054239065, -0.022978583732947467)), Coord2(-0.30434707847945847, -0.02297858118992223))
        .curve_to((Coord2(-0.3120539056003936, -0.023706196263339196), Coord2(-0.3198636629496291, -0.02537901457368068)), Coord2(-0.3274416369838766, -0.02693687983283266))
        .curve_to((Coord2(-0.3271354710454992, -0.026694695252479434), Coord2(-0.3268293051071218, -0.02645251067212621)), Coord2(-0.32652304730977705, -0.026210253429132614))
        .curve_to((Coord2(-0.329423498850482, -0.03245097399472986), Coord2(-0.3307959071399332, -0.036128016230770776)), Coord2(-0.3393205827089828, -0.03602861458185757))
        .curve_to((Coord2(-0.33932065833466574, -0.03602861369343664), Coord2(-0.33932073396034873, -0.036028612805015715)), Coord2(-0.33932080960872163, -0.03602861191632823))
        .curve_to((Coord2(-0.34868776989650424, -0.0359177562241199), Coord2(-0.34477460588427533, -0.044859092091503384)), Coord2(-0.3420780927027841, -0.04997346376573701))
        .curve_to((Coord2(-0.3420780735291021, -0.04997350013588978), Coord2(-0.3420780543554201, -0.049973536506042554)), Coord2(-0.3420780351759854, -0.04997357288710746))
        .curve_to((Coord2(-0.33812860497868563, -0.0574660239786037), Coord2(-0.33372421548192527, -0.06402102578857394)), Coord2(-0.32874304643841135, -0.07084978779619097))
        .curve_to((Coord2(-0.3287430022892668, -0.07084984833191385), Coord2(-0.32874295814012217, -0.07084990886763672)), Coord2(-0.32874291397773153, -0.07084996942152212))
        .curve_to((Coord2(-0.3239474015852363, -0.07742659631639354), Coord2(-0.31427166918830307, -0.07839602185387494)), Coord2(-0.307042109133505, -0.0757486100413291))
        .curve_to((Coord2(-0.30704216999364786, -0.07574863233302079), Coord2(-0.3070422308537908, -0.07574865462471247)), Coord2(-0.30704229173219355, -0.07574867692309234))
        .curve_to((Coord2(-0.3003771721367229, -0.0733068301046398), Coord2(-0.29233484507390084, -0.07104867598878009)), Coord2(-0.28555505053238844, -0.07431658265326699))
        .curve_to((Coord2(-0.28555512258580273, -0.07431654793121761), Coord2(-0.2855551946392171, -0.07431651320916825)), Coord2(-0.2855552667142496, -0.07431647847670123))
        .curve_to((Coord2(-0.27865242775038684, -0.07764212576085149), Coord2(-0.28106854493779976, -0.0899413317175421)), Coord2(-0.28115443354269154, -0.09629626384743457))
        .curve_to((Coord2(-0.28115443354348263, -0.09629626390596613), Coord2(-0.28115443354427366, -0.09629626396449768)), Coord2(-0.281154433545065, -0.0962962640230468))
        .curve_to((Coord2(-0.2813527222154595, -0.11096757538010826), Coord2(-0.27984938483357713, -0.1256275783116822)), Coord2(-0.2799330366007698, -0.1403094806786276))
        .curve_to((Coord2(-0.2799330361619894, -0.14030940242914747), Coord2(-0.279933035723209, -0.1403093241796673)), Coord2(-0.27993303528429697, -0.14030924590670996))
        .curve_to((Coord2(-0.2799781100067879, -0.1484789561330733), Coord2(-0.28297480763363625, -0.15846893741479237)), Coord2(-0.2888726052376738, -0.16445548538742885))
        .curve_to((Coord2(-0.28890841389301347, -0.16448799307709575), Coord2(-0.28894422254835317, -0.16452050076676264)), Coord2(-0.2889800419473638, -0.16455301820971174))
        .curve_to((Coord2(-0.30699579063870674, -0.17916246292698493), Coord2(-0.3222320133559351, -0.19370550566896383)), Coord2(-0.33390943256686506, -0.2143189640665167))
        .curve_to((Coord2(-0.33390941433577287, -0.21431893188104825), Coord2(-0.3339093961046807, -0.21431889969557982)), Coord2(-0.3339093778681186, -0.21431886750045476))
        .curve_to((Coord2(-0.34791376466683244, -0.2390448982297831), Coord2(-0.3536238582044542, -0.2746582702998919)), Coord2(-0.3472287001065815, -0.3026632451429439))
        .curve_to((Coord2(-0.3472287110413716, -0.3026631972709893), Coord2(-0.34722872197616167, -0.3026631493990347)), Coord2(-0.3472287329142325, -0.3026631015127171))
        .curve_to((Coord2(-0.3426422060995585, -0.32273745103354645), Coord2(-0.33791393815016924, -0.34264268231914913)), Coord2(-0.3325559327519878, -0.3625310895814078))
        .curve_to((Coord2(-0.3325559326954593, -0.3625310897912366), Coord2(-0.33255593263893074, -0.36253109000106537)), Coord2(-0.33255593258238525, -0.36253109021095714))
        .curve_to((Coord2(-0.32652511266435813, -0.38491696571075984), Coord2(-0.32519050810276556, -0.4036691716304828)), Coord2(-0.3264035794976333, -0.42652997723298003))
        .curve_to((Coord2(-0.3264035796092317, -0.42652997933599934), Coord2(-0.3264035797208302, -0.42652998143901866)), Coord2(-0.32640357983246204, -0.4265299835426689))
        .curve_to((Coord2(-0.3276178120066616, -0.4494105661588681), Coord2(-0.33381931085420324, -0.4675593515419617)), Coord2(-0.34617375160236424, -0.4870842542805552))
        .curve_to((Coord2(-0.34617379610164195, -0.4870843245920952), Coord2(-0.3461738406009196, -0.4870843949036352)), Coord2(-0.3461738851135484, -0.4870844652362708))
        .curve_to((Coord2(-0.35648480354078943, -0.5033728818349804), Coord2(-0.3724701455677725, -0.5094491624195944)), Coord2(-0.39111471202674797, -0.5121325574438311))
        .curve_to((Coord2(-0.3911146436774566, -0.5121325476011976), Coord2(-0.3911145753281652, -0.512132537758564)), Coord2(-0.39111450695836697, -0.5121325279129775))
        .curve_to((Coord2(-0.4145770839527672, -0.5155131595658244), Coord2(-0.4376145937636601, -0.5158482885014188)), Coord2(-0.46083412807727625, -0.5219443602860538))
        .curve_to((Coord2(-0.4608341791065904, -0.521944373680008), Coord2(-0.4608342301359046, -0.5219443870739623)), Coord2(-0.46083428118052905, -0.521944400471935))
        .curve_to((Coord2(-0.46774102363487696, -0.5237568036996396), Coord2(-0.46956933189646766, -0.5337124517262813)), Coord2(-0.4692448119386892, -0.5396187014530652))
        .curve_to((Coord2(-0.4692448153780034, -0.5396186389400046), Coord2(-0.46924481881731755, -0.5396185764269441)), Coord2(-0.4692448222576636, -0.5396185138951277))
        .curve_to((Coord2(-0.4686219368392018, -0.5509252261836611), Coord2(-0.46407658857824274, -0.5629515442267727)), Coord2(-0.4594273433236329, -0.5729264769528561))
        .curve_to((Coord2(-0.4594273213775923, -0.5729265240453393), Coord2(-0.45942729943155175, -0.5729265711378225)), Coord2(-0.4594272774789267, -0.5729266182444348))
        .curve_to((Coord2(-0.4531855496663553, -0.5863224023914289), Coord2(-0.44435022946069686, -0.5991960370713968)), Coord2(-0.43550480054762225, -0.611024956092507))
        .curve_to((Coord2(-0.43574566788932684, -0.6117055183777765), Coord2(-0.43598653523103137, -0.6123860806630461)), Coord2(-0.4362274748401652, -0.6130668471374202))
        .curve_to((Coord2(-0.44552497665985247, -0.6154249002107889), Coord2(-0.457317445155012, -0.6147039276850074)), Coord2(-0.4654038623610067, -0.6092154483820176))
        .curve_to((Coord2(-0.46484860805749756, -0.608554221127712), Coord2(-0.46429335375398845, -0.6078929938734062)), Coord2(-0.46373793285752896, -0.6072315682310855))
        .curve_to((Coord2(-0.45486656639924267, -0.6163786714763344), Coord2(-0.4418293462847598, -0.6247430791742672)), Coord2(-0.4290405564979067, -0.6264120547435372))
        .curve_to((Coord2(-0.42867218017069075, -0.6269324528752039), Coord2(-0.4283038038434749, -0.6274528510068705)), Coord2(-0.4279353169923084, -0.6279734052735902))
        .curve_to((Coord2(-0.43079746640307104, -0.6414649528375553), Coord2(-0.449021955119389, -0.6420771110325798)), Coord2(-0.46001496446887674, -0.6399848523821672))
        .curve_to((Coord2(-0.45969477925539143, -0.6391963045000807), Coord2(-0.45937459404190617, -0.6384077566179942)), Coord2(-0.4590543127632503, -0.6376189721478842))
        .curve_to((Coord2(-0.44914069205494356, -0.6441614209059257), Coord2(-0.43496780160583765, -0.6463698472711057)), Coord2(-0.42340214116141195, -0.6435577338814952))
        .curve_to((Coord2(-0.4228679177318135, -0.6439348683789963), Coord2(-0.422333694302215, -0.6443120028764973)), Coord2(-0.4217993105895594, -0.6446892505256627))
        .curve_to((Coord2(-0.4207143235598605, -0.6551995517370389), Coord2(-0.4292763427044811, -0.6664155152703215)), Coord2(-0.43693556862762994, -0.6727287184206986))
        .curve_to((Coord2(-0.437282583794391, -0.6719656929013913), Coord2(-0.43762959896115206, -0.6712026673820841)), Coord2(-0.4379767182428746, -0.670439412932228))
        .curve_to((Coord2(-0.42731742241021864, -0.6686721889585321), Coord2(-0.41445260875464696, -0.6648915867905033)), Coord2(-0.4055072128775951, -0.6584388092143818))
        .curve_to((Coord2(-0.40500883810610144, -0.6584322089745159), Coord2(-0.4045104633346077, -0.6584256087346501)), Coord2(-0.40401193903572985, -0.6584190065145142))
        .curve_to((Coord2(-0.393773455325032, -0.6653999164535019), Coord2(-0.37934205395273546, -0.6690459276256294)), Coord2(-0.3670145558558107, -0.6694329634144258))
        .curve_to((Coord2(-0.36671497259453567, -0.6695663227380925), Coord2(-0.3664153893332607, -0.6696996820617591)), Coord2(-0.36611571618801886, -0.669833081397224))
        .curve_to((Coord2(-0.36235219068488456, -0.673756847034005), Coord2(-0.35869905577599615, -0.6809809627798283)), Coord2(-0.3531506657748184, -0.6825795510801282))
        .curve_to((Coord2(-0.35315074292353976, -0.6825795288599591), Coord2(-0.3531508200722611, -0.6825795066397901)), Coord2(-0.3531508972441294, -0.6825794844129542))
        .curve_to((Coord2(-0.34867112455688326, -0.6838692878740873), Coord2(-0.3438883887520872, -0.6845576283706452)), Coord2(-0.3392514250034593, -0.6849739666066972))
        .curve_to((Coord2(-0.33903586457381474, -0.685054590003115), Coord2(-0.3388203041441702, -0.6851352133995328)), Coord2(-0.3386046790399293, -0.6852158609853883))
        .curve_to((Coord2(-0.33487900361876244, -0.687911087721984), Coord2(-0.3316056712557012, -0.6915846512769235)), Coord2(-0.3265074765389528, -0.6909829520457529))
        .curve_to((Coord2(-0.32650750364822795, -0.6909829552461088), Coord2(-0.32650753075750305, -0.6909829584464646)), Coord2(-0.3265075578749118, -0.6909829616477806))
        .curve_to((Coord2(-0.30724288462950083, -0.6887080773939092), Coord2(-0.2912932953375833, -0.6812813443873026)), Coord2(-0.27453708600749493, -0.6718117956308357))
        .curve_to((Coord2(-0.2745371532453754, -0.6718118336373237), Coord2(-0.2745372204832559, -0.6718118716438116)), Coord2(-0.27453728774130975, -0.6718119096617027))
        .curve_to((Coord2(-0.26901204146930996, -0.6686880927333027), Coord2(-0.2623299030119117, -0.6645390695703751)), Coord2(-0.25912724071854737, -0.6588555913298078))
        .curve_to((Coord2(-0.25912732544688805, -0.6588557417595677), Coord2(-0.2591274101752288, -0.6588558921893278)), Coord2(-0.2591274949289905, -0.6588560426642213))
        .curve_to((Coord2(-0.2526128347547973, -0.6472842969234341), Coord2(-0.24793816006350908, -0.6314621869349699)), Coord2(-0.2495100750345528, -0.6180684768820912))
        .curve_to((Coord2(-0.2493994467378644, -0.6177251661010211), Coord2(-0.24928881844117598, -0.6173818553199512)), Coord2(-0.2491781569526794, -0.6170384415353464))
        .curve_to((Coord2(-0.24226384823418126, -0.6094704780282215), Coord2(-0.2361347671824815, -0.6017669641402297)), Coord2(-0.23100281076505866, -0.5928109851941715))
        .curve_to((Coord2(-0.2310028142341058, -0.5928109912482549), Coord2(-0.23100281770315292, -0.5928109973023383)), Coord2(-0.2310028211732409, -0.5928110033582381))
        .curve_to((Coord2(-0.2142414308119289, -0.5635589516907116), Coord2(-0.20686190920868594, -0.533537889900321)), Coord2(-0.2005796313235877, -0.5002766021121852))
        .curve_to((Coord2(-0.20057963134533457, -0.5002766022273233), Coord2(-0.20057963136708143, -0.5002766023424613)), Coord2(-0.20057963138883483, -0.500276602457634))
        .curve_to((Coord2(-0.1934610054902067, -0.46258724526254097), Coord2(-0.194981440433055, -0.4214628341165092)), Coord2(-0.19693642188392183, -0.38319149333429325))
        .curve_to((Coord2(-0.19642571450094234, -0.3827423065229296), Coord2(-0.19591500711796286, -0.382293119711566)), Coord2(-0.19540414650744573, -0.381843798130682))
        .curve_to((Coord2(-0.18194235673237438, -0.38428014970522323), Coord2(-0.16832193027932196, -0.3861184082941944)), Coord2(-0.1549869337455326, -0.38919215526991346))
        .curve_to((Coord2(-0.15498683783130776, -0.3891921773898154), Coord2(-0.1549867419170829, -0.38919219950971734)), Coord2(-0.1549866459740809, -0.3891922216362559))
        .curve_to((Coord2(-0.14716593049449977, -0.3909967824662834), Coord2(-0.13929937427387454, -0.39249972851796083)), Coord2(-0.1314833459037242, -0.39435823076945864))
        .curve_to((Coord2(-0.13148335298108904, -0.39435822908665913), Coord2(-0.13148336005845385, -0.3943582274038597)), Coord2(-0.1314833671379421, -0.3943582257205553))
        .curve_to((Coord2(-0.12692255570343358, -0.3954426187901425), Coord2(-0.10969062731387905, -0.3987619911653651)), Coord2(-0.1112469660102514, -0.40204006376469664))
        .curve_to((Coord2(-0.11140843551901693, -0.40238016246785524), Coord2(-0.11180597155406044, -0.4026429557391609)), Coord2(-0.11216409746660726, -0.4027293447543095))
        .curve_to((Coord2(-0.11214988499208359, -0.4027256608665443), Coord2(-0.11213567251755992, -0.4027219769787791)), Coord2(-0.11212145577886748, -0.40271829198573705))
        .curve_to((Coord2(-0.13532030374758625, -0.4091521470962382), Coord2(-0.1594311296643878, -0.4146760208575735)), Coord2(-0.18318706608742258, -0.41864630522119245))
        .curve_to((Coord2(-0.18318732932951523, -0.41864634913314436), Coord2(-0.18318759257160788, -0.4186463930450963)), Coord2(-0.18318785589268105, -0.41864643697022313))
        .curve_to((Coord2(-0.1877382677810979, -0.4194040624838271), Coord2(-0.19022719677203245, -0.42111922116478245)), Coord2(-0.1905580452612918, -0.42627612606611087))
        .curve_to((Coord2(-0.19055804057689385, -0.4262760529542485), Coord2(-0.19055803589249593, -0.4262759798423861)), Coord2(-0.1905580312066925, -0.42627590670858795))
        .curve_to((Coord2(-0.19150417976443454, -0.44106250411647485), Coord2(-0.1907650549171636, -0.4559359872282427)), Coord2(-0.19157812489293877, -0.47073035054548723))
        .curve_to((Coord2(-0.1915781237531419, -0.4707303297970391), Coord2(-0.191578122613345, -0.470730309048591)), Coord2(-0.19157812147320616, -0.4707302882939177))
        .curve_to((Coord2(-0.19172481363180738, -0.47340178679165823), Coord2(-0.19111035428016904, -0.47718417876851105)), Coord2(-0.18900603565638097, -0.4790624725872094))
        .curve_to((Coord2(-0.18900593636366922, -0.47906256124225705), Coord2(-0.1890058370709575, -0.47906264989730474)), Coord2(-0.18900573774845497, -0.47906273857895154))
        .curve_to((Coord2(-0.18371164763271555, -0.48379110893913946), Coord2(-0.17785669458662573, -0.48842593340515383)), Coord2(-0.17173211825671555, -0.492059873575714))
        .curve_to((Coord2(-0.17152289672393586, -0.4923795998031979), Coord2(-0.17131367519115617, -0.4926993260306818)), Coord2(-0.1711043908856394, -0.4930191481856267))
        .curve_to((Coord2(-0.169148383750491, -0.5087635114122977), Coord2(-0.16956829149748337, -0.5079257513478811)), Coord2(-0.1556782126707341, -0.5190676776236582))
        .curve_to((Coord2(-0.15567821395972042, -0.519067676589702), Coord2(-0.15567821524870679, -0.5190676755557456)), Coord2(-0.15567821653807987, -0.5190676745214792))
        .curve_to((Coord2(-0.12227162340892903, -0.5458645630618224), Coord2(-0.08181563813943708, -0.5683478708107943)), Coord2(-0.045711763503237864, -0.5913653903874535))
        .curve_to((Coord2(-0.009414278873720705, -0.6145063433035074), Coord2(0.030666930119636615, -0.6450042906741692)), Coord2(0.07025425926511102, -0.6619646510225518))
        .curve_to((Coord2(0.07025429695161862, -0.661964667170652), Coord2(0.07025433463812623, -0.6619646833187522)), Coord2(0.07025437233594092, -0.6619646994716974))
        .curve_to((Coord2(0.10437219431672687, -0.6765855793138396), Coord2(0.13698437906923333, -0.7006884042147811)), Coord2(0.16890410090637303, -0.7194361032107188))
        .curve_to((Coord2(0.1706261962678057, -0.720447557058693), Coord2(0.20980792856692096, -0.7457358132570723)), Coord2(0.22157283554505292, -0.7474776036459058))
        .curve_to((Coord2(0.22157284639285146, -0.7474776052520586), Coord2(0.22157285724065, -0.7474776068582115)), Coord2(0.22157286809170323, -0.7474776084648462))
        .curve_to((Coord2(0.23767715143317003, -0.7498622578651732), Coord2(0.25437485744540145, -0.7457810314465694)), Coord2(0.27003176483349994, -0.7425990284426922))
        .curve_to((Coord2(0.270031707745291, -0.7425990400489001), Coord2(0.2700316506570821, -0.7425990516551081)), Coord2(0.270031593551745, -0.7425990632647982))
        .curve_to((Coord2(0.4000631809289299, -0.7161541545893791), Coord2(0.5296171210131171, -0.6823835437778768)), Coord2(0.6588794561529997, -0.6521124911296513))
        .curve_to((Coord2(0.6586274784997747, -0.6522797220454863), Coord2(0.6583755008465496, -0.6524469529613213)), Coord2(0.6581234475924685, -0.6526142340514485))
        .curve_to((Coord2(0.6929501544189359, -0.6047458767852776), Coord2(0.8079788117369141, -0.58318644360085)), Coord2(0.8644557937580435, -0.5762726983608795))
        .curve_to((Coord2(0.8644286726504351, -0.5771300413975414), Coord2(0.8644015515428267, -0.5779873844342034)), Coord2(0.8643744222980724, -0.5788449846994992))
        .curve_to((Coord2(0.8289185592914365, -0.5722076629917444), Coord2(0.7913070702086766, -0.5387989660178114)), Coord2(0.7923931739503459, -0.5004813699398388))
        .curve_to((Coord2(0.7923931746610674, -0.5004813448912129), Coord2(0.7923931753717889, -0.5004813198425869)), Coord2(0.7923931760827236, -0.5004812947864457))
        .curve_to((Coord2(0.7935692169484435, -0.45907514509756225), Coord2(0.8669319479621769, -0.38770891796341755)), Coord2(0.8991770989176897, -0.3565044269607809))
        .curve_to((Coord2(0.8996112481352182, -0.35722960250491886), Coord2(0.9000453973527467, -0.35795477804905684)), Coord2(0.9004796768280662, -0.35868017116761547))
        .curve_to((Coord2(0.8316503484375368, -0.38072056176701624), Coord2(0.7550242729318613, -0.378133801897687)), Coord2(0.683787785517256, -0.3868575303772272))
        .curve_to((Coord2(0.6837878038743219, -0.386857528128796), Coord2(0.6837878222313878, -0.3868575258803648)), Coord2(0.6837878405939612, -0.386857523631259))
        .curve_to((Coord2(0.6291061803023987, -0.39355628804784176), Coord2(0.5002788213328719, -0.37108383286003843)), Coord2(0.4637472219499875, -0.3289414652342699))
        .curve_to((Coord2(0.4637472201009694, -0.32894146310125316), Coord2(0.46374721825195125, -0.3289414609682364)), Coord2(0.46374721640237837, -0.3289414588345797))
        .curve_to((Coord2(0.43544353315943285, -0.2962902768341204), Coord2(0.5225144895211472, -0.17465212058166876)), Coord2(0.5468534812409116, -0.14264424299967415))
        .curve_to((Coord2(0.5475103609280023, -0.14320918135836241), Coord2(0.548167240615093, -0.1437741197170507)), Coord2(0.5488243173857983, -0.14433922757419643))
        .curve_to((Coord2(0.5152300715198739, -0.17895297834208684), Coord2(0.4783916267348987, -0.2081818002746187)), Coord2(0.4411010522164092, -0.23860530176138228))
        .curve_to((Coord2(0.4411010506499568, -0.2386053030393658), Coord2(0.44110104908350445, -0.23860530431734933)), Coord2(0.4411010475165821, -0.2386053055957163))
        .curve_to((Coord2(0.3788905741009726, -0.2893592147340731), Coord2(0.30551821345076785, -0.2979507095813882)), Coord2(0.2286293758170183, -0.2927027121866866))
        .curve_to((Coord2(0.22862935907318532, -0.2927027110435219), Coord2(0.22862934232935234, -0.29270270990035724)), Coord2(0.2286293255804957, -0.2927027087568496))
        .curve_to((Coord2(0.16684621234303937, -0.288483342334449), Coord2(0.10355967391387735, -0.2722021867377304)), Coord2(0.04371073118761092, -0.25597812898482525))
        .curve_to((Coord2(0.04344575963499179, -0.255346975843678), Coord2(0.04318078808237266, -0.2547158227025307)), Coord2(0.042915737030337804, -0.2540844801965046))
        .curve_to((Coord2(0.05486866739312637, -0.23277168919871744), Coord2(0.06524221079295447, -0.21114299927300603)), Coord2(0.07091444583754589, -0.18715613038072182))
        .curve_to((Coord2(0.07091446279425656, -0.1871560587009836), Coord2(0.07091447975096725, -0.18715598702124536)), Coord2(0.07091449671276545, -0.18715591532000106))
        .curve_to((Coord2(0.07480834770838016, -0.1707019854252374), Coord2(0.07795991260804079, -0.1530542865797651)), Coord2(0.07821817352004959, -0.13607393408292115))
        .curve_to((Coord2(0.07828405823267806, -0.13585057304338888), Coord2(0.07834994294530653, -0.1356272120038566)), Coord2(0.07841584742532554, -0.135403783949311))
        .curve_to((Coord2(0.09354439099719411, -0.11119074464113501), Coord2(0.11057359160730734, -0.10052986400033126)), Coord2(0.13519948929654693, -0.08845587958454737))
        .curve_to((Coord2(0.13519948892173533, -0.0884558797683163), Coord2(0.13519948854692374, -0.08845587995208523)), Coord2(0.1351994881719997, -0.0884558801359093))
        .curve_to((Coord2(0.17324283920123718, -0.06980332374972972), Coord2(0.21665134549191944, -0.08522707821477303)), Coord2(0.25677716841300374, -0.08343627390081629))
        .curve_to((Coord2(0.25677717256585764, -0.0834362737154955), Coord2(0.2567771767187116, -0.08343627353017471)), Coord2(0.2567771808728115, -0.08343627334479833))
        .curve_to((Coord2(0.2977671277960354, -0.08160729682746842), Coord2(0.33619512118806344, -0.07711835218609353)), Coord2(0.362181055405466, -0.04116954507689339))
        .curve_to((Coord2(0.3621810645323523, -0.04116953245128338), Coord2(0.36218107365923863, -0.04116951982567338)), Coord2(0.36218108278886324, -0.04116950719627531))
        .curve_to((Coord2(0.3929986921986555, 0.0014601911068285872), Coord2(0.3968572257178567, 0.0407630874743128)), Coord2(0.35604246716006316, 0.07849183525137561))
        .curve_to((Coord2(0.35604245548460395, 0.07849184604444802), Coord2(0.35604244380914474, 0.07849185683752043)), Coord2(0.35604243213018255, 0.07849186763383108))
        .curve_to((Coord2(0.323427028341043, 0.10864343131100389), Coord2(0.29301469873966673, 0.12689439740838573)), Coord2(0.25324663601052616, 0.14738686229959783))
        .curve_to((Coord2(0.25324666299936915, 0.14738684839345384), Coord2(0.25324668998821215, 0.14738683448730985)), Coord2(0.2532467169851526, 0.1473868205769936))
        .curve_to((Coord2(0.20298696296831836, 0.1732811997188275), Coord2(0.14873373865495942, 0.17703569647749318)), Coord2(0.09351792332765009, 0.18077902168893564))
        .curve_to((Coord2(0.09351790058951137, 0.18077902323105477), Coord2(0.09351787785137264, 0.18077902477317392)), Coord2(0.09351785510641179, 0.18077902631575574))
        .curve_to((Coord2(0.07964352459937964, 0.18172036071744654), Coord2(0.06196111566891791, 0.1857948171912749)), Coord2(0.048303922092872605, 0.18478217543041475))
        .curve_to((Coord2(0.04863496283392975, 0.18545262289624542), Coord2(0.0489660035749869, 0.18612307036207607)), Coord2(0.04929714363819858, 0.1867937189822619))
        .curve_to((Coord2(0.052892399953694706, 0.18130016168037588), Coord2(0.03860761777684189, 0.1862899722740409)), Coord2(0.04640044395687259, 0.18720824234238914))
        .curve_to((Coord2(0.04696491869384691, 0.18726465319093263), Coord2(0.04752939343082124, 0.18732106403947615)), Coord2(0.048110973462855394, 0.18737918430767248))
        .curve_to((Coord2(0.04817541180839825, 0.18651361080097037), Coord2(0.04823985015394111, 0.18564803729426824)), Coord2(0.04830430783292097, 0.18478220408954432))
        .build();

    path.prepare_to_render();

    let y_pos       = 0.22037037037037033;
    render_path(&path, y_pos);

    // Forward
    println!("-- Forward");
    let intercepts  = path.intercepts_on_line(y_pos).collect::<Vec<_>>();

    assert!(intercepts.len()%2 == 0, "Uneven number of intercepts ({:?})", intercepts);

    // Reversed
    println!("-- Reversed");
    let mut reversed_path   = path.reversed::<BezierSubpath>();
    reversed_path.prepare_to_render();
    let intercepts          = reversed_path.intercepts_on_line(y_pos).collect::<Vec<_>>();

    assert!(intercepts.len()%2 == 0, "Uneven number of intercepts ({:?})", intercepts);
}

#[test]
pub fn intercepts_3() {
    // Has two very close intercepts that are relatively far apart in terms of the curve's arc length
    let mut path = BezierPathBuilder::<BezierSubpath>::start(Coord2(-0.21971055224803498, -0.07626466346947276))
        .curve_to((Coord2(-0.21999702644031982, -0.07816240183136655), Coord2(-0.22232964285361873, -0.07778246186966635)), Coord2(-0.22236227459942665, -0.07601509758645536))
        .curve_to((Coord2(-0.22241645222423337, -0.07308078939478602), Coord2(-0.22151004579707395, -0.06372163603660543)), Coord2(-0.22297488846212313, -0.06196387189420541))
        .curve_to((Coord2(-0.22230810369408546, -0.061408203045884895), Coord2(-0.22164131892604777, -0.06085253419756438)), Coord2(-0.22097433410257414, -0.06029669863191764))
        .curve_to((Coord2(-0.21879884894660753, -0.0629072109351985), Coord2(-0.2197195287104749, -0.07068290358978786)), Coord2(-0.2197507421269847, -0.07413746442134185))
        .curve_to((Coord2(-0.2197712607587037, -0.07640837447796099), Coord2(-0.22235448602023228, -0.07633264920348175)), Coord2(-0.22228554531666228, -0.0758759539011327))
        .curve_to((Coord2(-0.2214273001268888, -0.07600551080026045), Coord2(-0.22056905493711532, -0.07613506769938819)), Coord2(-0.21971055224803498, -0.07626466346947276))
        .build();
    let y_pos       = -0.07592592592592584;

    path.prepare_to_render();
    render_path(&path, y_pos);

    // Forward
    let intercepts  = path.intercepts_on_line(y_pos).collect::<Vec<_>>();

    assert!(intercepts.len()%2 == 0, "Uneven number of intercepts ({:?})", intercepts);

    // Reversed
    let mut reversed_path   = path.reversed::<BezierSubpath>();
    reversed_path.prepare_to_render();
    let intercepts          = reversed_path.intercepts_on_line(y_pos).collect::<Vec<_>>();

    assert!(intercepts.len()%2 == 0, "Uneven number of intercepts ({:?})", intercepts);
}

#[test]
pub fn intercepts_4() {
    // Intercepts_1 again, but we try all the y positions that exactly hits a control point (which will intercept on both sides)
    let mut path = BezierPathBuilder::<BezierSubpath>::start(Coord2(-0.2037662266584257, -0.34995458248326766))
        .curve_to((Coord2(-0.20006384207737574, -0.35319049320697476), Coord2(-0.19778599976302993, -0.3576703897326853)), Coord2(-0.19431519023924634, -0.36111487969372347))
        .curve_to((Coord2(-0.19431503462317426, -0.36111503420780017), Coord2(-0.1943148790071022, -0.3611151887218768)), Coord2(-0.19431472334434063, -0.3611153432823124))
        .curve_to((Coord2(-0.18294289255315344, -0.3724123516207334), Coord2(-0.16958474910311086, -0.3835618084981183)), Coord2(-0.15358122129524585, -0.38745096337884))
        .curve_to((Coord2(-0.15358119165293727, -0.3874509705835756), Coord2(-0.15358116201062869, -0.38745097778831117)), Coord2(-0.15358113235942653, -0.3874509849952084))
        .curve_to((Coord2(-0.14395285570388705, -0.3897915520488139), Coord2(-0.13347754501911002, -0.38814846670720726)), Coord2(-0.12368297576904297, -0.38814846670720726))
        .curve_to((Coord2(-0.12368297576904297, -0.38814846670720726), Coord2(-0.12368297576904297, -0.38814846670720726)), Coord2(-0.12368297576904297, -0.38814846670720726))
        .curve_to((Coord2(-0.11573407727766122, -0.38814846670720726), Coord2(-0.10778901214865767, -0.387407625817904)),  Coord2(-0.10026765180850696, -0.3845881040578401))
        .curve_to((Coord2(-0.10026771361469485, -0.3845881272323997), Coord2(-0.10026777542088273, -0.38458815040695926)), Coord2(-0.10026783724561433, -0.3845881735884719))
        .curve_to((Coord2(-0.09822388934861571, -0.3838216071313091), Coord2(-0.09396942460443825, -0.3849772284862197)), Coord2(-0.09396942460443825, -0.38279426097869873))
        .curve_to((Coord2(-0.09310145582857077, -0.38279426097869873), Coord2(-0.09223348705270328, -0.38279426097869873)), Coord2(-0.09136525786016136, -0.38279426097869873))
        .curve_to((Coord2(-0.09136525786016136, -0.3851364602855769), Coord2(-0.09784821500867084, -0.38646200322312213)), Coord2(-0.0993533633159091, -0.3870264971650071))
        .curve_to((Coord2(-0.099353425122097, -0.3870265203395667), Coord2(-0.09935348692828488, -0.38702654351412624)), Coord2(-0.09935354875301648, -0.3870265666956389))
        .curve_to((Coord2(-0.10712695885690601, -0.3899405739957303), Coord2(-0.1154278620549664, -0.39075263345148414)), Coord2(-0.12368297576904297, -0.39075263345148414))
        .curve_to((Coord2(-0.12368297576904297, -0.39075263345148414), Coord2(-0.12368297576904297, -0.39075263345148414)), Coord2(-0.12368297576904297, -0.39075263345148414))
        .curve_to((Coord2(-0.13373978674827755, -0.39075263345148414), Coord2(-0.14429743492929809, -0.39238779522746203)), Coord2(-0.15419627242572972, -0.38998145671621737))
        .curve_to((Coord2(-0.15419624278342114, -0.38998146392095295), Coord2(-0.15419621314111256, -0.38998147112568854)), Coord2(-0.1541961834899104, -0.3899814783325858))
        .curve_to((Coord2(-0.17063635371210378, -0.38598621122478494), Coord2(-0.1844484936444886, -0.37458740886243014)), Coord2(-0.19615005937050312, -0.36296283512344935))
        .curve_to((Coord2(-0.19614990375443103, -0.36296298963752605), Coord2(-0.19614974813835898, -0.3629631441516027)), Coord2(-0.1961495924755974, -0.36296329871203825))
        .curve_to((Coord2(-0.19957834020225215, -0.3595605515885026), Coord2(-0.20183200830256534, -0.35510373526121125)), Coord2(-0.20547997962514364, -0.3519153821163417))
        .curve_to((Coord2(-0.20490878576133656, -0.35126184759863815), Coord2(-0.20433759189752945, -0.35060831308093454)), Coord2(-0.2037662266584257, -0.34995458248326766))
        .build();

    path.prepare_to_render();

    for y_pos in path.to_curves::<Curve<_>>().into_iter().map(|curve| curve.start_point().y()) {
        // Forward
        let intercepts  = path.intercepts_on_line(y_pos).collect::<Vec<_>>();

        if intercepts.len()%2 != 0 {
            render_path(&path, y_pos);
        }

        assert!(intercepts.len()%2 == 0, "Uneven number of intercepts at ypos {:?} ({:?})", y_pos, intercepts);
    }

    let mut reversed_path = path.reversed::<BezierSubpath>();
    reversed_path.prepare_to_render();
    for y_pos in reversed_path.to_curves::<Curve<_>>().into_iter().map(|curve| curve.start_point().y()) {
        // Reversed
        let intercepts = reversed_path.intercepts_on_line(y_pos).collect::<Vec<_>>();

        if intercepts.len()%2 != 0 {
            render_path(&path, y_pos);
        }

        assert!(intercepts.len()%2 == 0, "Uneven number of intercepts when reversed at ypos {:?} ({:?})", y_pos, intercepts);
    }
}

#[test]
pub fn intercepts_5() {
    // As for intercepts_1 but we've made the last curve a 'very short' curve (removing the last part might leave an unclosed curve)
    let mut path = BezierPathBuilder::<BezierSubpath>::start(Coord2(-0.2037662266584257, -0.34995458248326766))
        .curve_to((Coord2(-0.20006384207737574, -0.35319049320697476), Coord2(-0.19778599976302993, -0.3576703897326853)), Coord2(-0.19431519023924634, -0.36111487969372347))
        .curve_to((Coord2(-0.19431503462317426, -0.36111503420780017), Coord2(-0.1943148790071022, -0.3611151887218768)), Coord2(-0.19431472334434063, -0.3611153432823124))
        .curve_to((Coord2(-0.18294289255315344, -0.3724123516207334), Coord2(-0.16958474910311086, -0.3835618084981183)), Coord2(-0.15358122129524585, -0.38745096337884))
        .curve_to((Coord2(-0.15358119165293727, -0.3874509705835756), Coord2(-0.15358116201062869, -0.38745097778831117)), Coord2(-0.15358113235942653, -0.3874509849952084))
        .curve_to((Coord2(-0.14395285570388705, -0.3897915520488139), Coord2(-0.13347754501911002, -0.38814846670720726)), Coord2(-0.12368297576904297, -0.38814846670720726))
        .curve_to((Coord2(-0.12368297576904297, -0.38814846670720726), Coord2(-0.12368297576904297, -0.38814846670720726)), Coord2(-0.12368297576904297, -0.38814846670720726))
        .curve_to((Coord2(-0.11573407727766122, -0.38814846670720726), Coord2(-0.10778901214865767, -0.387407625817904)), Coord2(-0.10026765180850696, -0.3845881040578401))
        .curve_to((Coord2(-0.10026771361469485, -0.3845881272323997), Coord2(-0.10026777542088273, -0.38458815040695926)), Coord2(-0.10026783724561433, -0.3845881735884719))
        .curve_to((Coord2(-0.09822388934861571, -0.3838216071313091), Coord2(-0.09396942460443825, -0.3849772284862197)), Coord2(-0.09396942460443825, -0.38279426097869873))
        .curve_to((Coord2(-0.09310145582857077, -0.38279426097869873), Coord2(-0.09223348705270328, -0.38279426097869873)), Coord2(-0.09136525786016136, -0.38279426097869873))
        .curve_to((Coord2(-0.09136525786016136, -0.3851364602855769), Coord2(-0.09784821500867084, -0.38646200322312213)), Coord2(-0.0993533633159091, -0.3870264971650071))
        .curve_to((Coord2(-0.099353425122097, -0.3870265203395667), Coord2(-0.09935348692828488, -0.38702654351412624)), Coord2(-0.09935354875301648, -0.3870265666956389))
        .curve_to((Coord2(-0.10712695885690601, -0.3899405739957303), Coord2(-0.1154278620549664, -0.39075263345148414)), Coord2(-0.12368297576904297, -0.39075263345148414))
        .curve_to((Coord2(-0.12368297576904297, -0.39075263345148414), Coord2(-0.12368297576904297, -0.39075263345148414)), Coord2(-0.12368297576904297, -0.39075263345148414))
        .curve_to((Coord2(-0.13373978674827755, -0.39075263345148414), Coord2(-0.14429743492929809, -0.39238779522746203)), Coord2(-0.15419627242572972, -0.38998145671621737))
        .curve_to((Coord2(-0.15419624278342114, -0.38998146392095295), Coord2(-0.15419621314111256, -0.38998147112568854)), Coord2(-0.1541961834899104, -0.3899814783325858))
        .curve_to((Coord2(-0.17063635371210378, -0.38598621122478494), Coord2(-0.1844484936444886, -0.37458740886243014)), Coord2(-0.19615005937050312, -0.36296283512344935))
        .curve_to((Coord2(-0.19614990375443103, -0.36296298963752605), Coord2(-0.19614974813835898, -0.3629631441516027)), Coord2(-0.1961495924755974, -0.36296329871203825))
        .curve_to((Coord2(-0.19957834020225215, -0.3595605515885026), Coord2(-0.20183200830256534, -0.35510373526121125)), Coord2(-0.20547997962514364, -0.3519153821163417))
        .curve_to((Coord2(-0.20490878576133656, -0.35126184759863815), Coord2(-0.20433759189752945, -0.35060831308093454)), Coord2(-0.2037662266584256, -0.34995458248326765))
        .curve_to((Coord2(-0.2037662266584256, -0.34995458248326765), Coord2(-0.2037662266584256, -0.34995458248326765)), Coord2(-0.2037662266584257, -0.34995458248326766))
        .build();

    path.prepare_to_render();

    for y_pos in path.to_curves::<Curve<_>>().into_iter().map(|curve| curve.start_point().y()) {
        // Forward
        let intercepts  = path.intercepts_on_line(y_pos).collect::<Vec<_>>();

        if intercepts.len()%2 != 0 {
            render_path(&path, y_pos);
        }

        assert!(intercepts.len()%2 == 0, "Uneven number of intercepts at ypos {:?} ({:?})", y_pos, intercepts);
    }

    let mut reversed_path = path.reversed::<BezierSubpath>();
    reversed_path.prepare_to_render();
    for y_pos in reversed_path.to_curves::<Curve<_>>().into_iter().map(|curve| curve.start_point().y()) {
        // Reversed
        let intercepts = reversed_path.intercepts_on_line(y_pos).collect::<Vec<_>>();

        if intercepts.len()%2 != 0 {
            render_path(&path, y_pos);
        }

        assert!(intercepts.len()%2 == 0, "Uneven number of intercepts when reversed at ypos {:?} ({:?})", y_pos, intercepts);
    }
}

#[test]
pub fn intercepts_6() {
    // As for intercepts_5 but we scale the path before converting it
    let path = BezierPathBuilder::<SimpleBezierPath>::start(Coord2(-0.2037662266584257, -0.34995458248326766))
        .curve_to((Coord2(-0.20006384207737574, -0.35319049320697476), Coord2(-0.19778599976302993, -0.3576703897326853)), Coord2(-0.19431519023924634, -0.36111487969372347))
        .curve_to((Coord2(-0.19431503462317426, -0.36111503420780017), Coord2(-0.1943148790071022, -0.3611151887218768)), Coord2(-0.19431472334434063, -0.3611153432823124))
        .curve_to((Coord2(-0.18294289255315344, -0.3724123516207334), Coord2(-0.16958474910311086, -0.3835618084981183)), Coord2(-0.15358122129524585, -0.38745096337884))
        .curve_to((Coord2(-0.15358119165293727, -0.3874509705835756), Coord2(-0.15358116201062869, -0.38745097778831117)), Coord2(-0.15358113235942653, -0.3874509849952084))
        .curve_to((Coord2(-0.14395285570388705, -0.3897915520488139), Coord2(-0.13347754501911002, -0.38814846670720726)), Coord2(-0.12368297576904297, -0.38814846670720726))
        .curve_to((Coord2(-0.12368297576904297, -0.38814846670720726), Coord2(-0.12368297576904297, -0.38814846670720726)), Coord2(-0.12368297576904297, -0.38814846670720726))
        .curve_to((Coord2(-0.11573407727766122, -0.38814846670720726), Coord2(-0.10778901214865767, -0.387407625817904)), Coord2(-0.10026765180850696, -0.3845881040578401))
        .curve_to((Coord2(-0.10026771361469485, -0.3845881272323997), Coord2(-0.10026777542088273, -0.38458815040695926)), Coord2(-0.10026783724561433, -0.3845881735884719))
        .curve_to((Coord2(-0.09822388934861571, -0.3838216071313091), Coord2(-0.09396942460443825, -0.3849772284862197)), Coord2(-0.09396942460443825, -0.38279426097869873))
        .curve_to((Coord2(-0.09310145582857077, -0.38279426097869873), Coord2(-0.09223348705270328, -0.38279426097869873)), Coord2(-0.09136525786016136, -0.38279426097869873))
        .curve_to((Coord2(-0.09136525786016136, -0.3851364602855769), Coord2(-0.09784821500867084, -0.38646200322312213)), Coord2(-0.0993533633159091, -0.3870264971650071))
        .curve_to((Coord2(-0.099353425122097, -0.3870265203395667), Coord2(-0.09935348692828488, -0.38702654351412624)), Coord2(-0.09935354875301648, -0.3870265666956389))
        .curve_to((Coord2(-0.10712695885690601, -0.3899405739957303), Coord2(-0.1154278620549664, -0.39075263345148414)), Coord2(-0.12368297576904297, -0.39075263345148414))
        .curve_to((Coord2(-0.12368297576904297, -0.39075263345148414), Coord2(-0.12368297576904297, -0.39075263345148414)), Coord2(-0.12368297576904297, -0.39075263345148414))
        .curve_to((Coord2(-0.13373978674827755, -0.39075263345148414), Coord2(-0.14429743492929809, -0.39238779522746203)), Coord2(-0.15419627242572972, -0.38998145671621737))
        .curve_to((Coord2(-0.15419624278342114, -0.38998146392095295), Coord2(-0.15419621314111256, -0.38998147112568854)), Coord2(-0.1541961834899104, -0.3899814783325858))
        .curve_to((Coord2(-0.17063635371210378, -0.38598621122478494), Coord2(-0.1844484936444886, -0.37458740886243014)), Coord2(-0.19615005937050312, -0.36296283512344935))
        .curve_to((Coord2(-0.19614990375443103, -0.36296298963752605), Coord2(-0.19614974813835898, -0.3629631441516027)), Coord2(-0.1961495924755974, -0.36296329871203825))
        .curve_to((Coord2(-0.19957834020225215, -0.3595605515885026), Coord2(-0.20183200830256534, -0.35510373526121125)), Coord2(-0.20547997962514364, -0.3519153821163417))
        .curve_to((Coord2(-0.20490878576133656, -0.35126184759863815), Coord2(-0.20433759189752945, -0.35060831308093454)), Coord2(-0.2037662266584256, -0.34995458248326765))
        .curve_to((Coord2(-0.2037662266584256, -0.34995458248326765), Coord2(-0.2037662266584256, -0.34995458248326765)), Coord2(-0.2037662266584257, -0.34995458248326766))
        .build();
    let mut path = path.map_points::<BezierSubpath>(|p| (p + Coord2(1.0, 1.0))*100.0);

    path.prepare_to_render();

    for y_pos in path.to_curves::<Curve<_>>().into_iter().map(|curve| curve.start_point().y()) {
        // Forward
        let intercepts  = path.intercepts_on_line(y_pos).collect::<Vec<_>>();

        if intercepts.len()%2 != 0 {
            render_path(&path, y_pos);
        }

        println!("y={:?} {:?}", y_pos, intercepts);
        assert!(intercepts.len()%2 == 0, "Uneven number of intercepts at ypos {:?} ({:?})", y_pos, intercepts);
    }

    let mut reversed_path = path.reversed::<BezierSubpath>();
    reversed_path.prepare_to_render();
    for y_pos in reversed_path.to_curves::<Curve<_>>().into_iter().map(|curve| curve.start_point().y()) {
        // Reversed
        let intercepts = reversed_path.intercepts_on_line(y_pos).collect::<Vec<_>>();

        if intercepts.len()%2 != 0 {
            render_path(&path, y_pos);
        }

        assert!(intercepts.len()%2 == 0, "Uneven number of intercepts when reversed at ypos {:?} ({:?})", y_pos, intercepts);
    }
}

#[test]
pub fn triangle_lower_edge_non_zero() {
    // Create a triangle subpath
    let triangle = BezierPathBuilder::<BezierSubpath>::start(Coord2(200.0, 200.0))
        .line_to(Coord2(800.0, 200.0))
        .line_to(Coord2(500.0, 800.0))
        .line_to(Coord2(200.0, 200.0))
        .build();

    // Non-zero winding rule
    let mut path = triangle.to_non_zero_edge(ShapeId::new());
    path.prepare_to_render();

    // Intercepts along the very bottom of the path
    let mut intercepts = vec![smallvec![]];
    path.intercepts(&[799.9], &mut intercepts);

    assert!(intercepts[0].len() == 2, "Should be 2 intercepts, found {:?}", intercepts[0]);
    assert!(intercepts[0][0].direction != intercepts[0][1].direction, "Intercept directions should invert (found {:?})", intercepts[0]);
}

#[test]
pub fn triangle_lower_edge_flattened_non_zero() {
    // Create a triangle subpath
    let triangle = BezierPathBuilder::<BezierSubpath>::start(Coord2(200.0, 200.0))
        .line_to(Coord2(800.0, 200.0))
        .line_to(Coord2(500.0, 800.0))
        .line_to(Coord2(200.0, 200.0))
        .build();

    // Non-zero winding rule
    let mut path = triangle.to_flattened_non_zero_edge(ShapeId::new());
    path.prepare_to_render();

    // Intercepts along the very bottom of the path
    let mut intercepts = vec![smallvec![]];
    path.intercepts(&[799.9], &mut intercepts);

    assert!(intercepts[0].len() == 2, "Should be 2 intercepts, found {:?}", intercepts[0]);
    assert!(intercepts[0][0].direction != intercepts[0][1].direction, "Intercept directions should invert (found {:?})", intercepts[0]);
}

#[test]
pub fn triangle_lower_edge_non_zero_very_close() {
    // Create a triangle subpath
    let triangle = BezierPathBuilder::<BezierSubpath>::start(Coord2(200.0, 200.0))
        .line_to(Coord2(800.0, 200.0))
        .line_to(Coord2(500.0, 800.0))
        .line_to(Coord2(200.0, 200.0))
        .build();

    // Non-zero winding rule
    let mut path = triangle.to_non_zero_edge(ShapeId::new());
    path.prepare_to_render();

    // Intercepts along the very bottom of the path
    let mut intercepts = vec![smallvec![]];
    path.intercepts(&[799.9999999999999], &mut intercepts);

    assert!(intercepts[0].len() == 2, "Should be 2 intercepts, found {:?}", intercepts[0]);
    assert!(intercepts[0][0].direction != intercepts[0][1].direction, "Intercept directions should invert (found {:?})", intercepts[0]);
}

#[test]
pub fn triangle_lower_edge_flattened_non_zero_very_close() {
    // Create a triangle subpath
    let triangle = BezierPathBuilder::<BezierSubpath>::start(Coord2(200.0, 200.0))
        .line_to(Coord2(800.0, 200.0))
        .line_to(Coord2(500.0, 800.0))
        .line_to(Coord2(200.0, 200.0))
        .build();

    // Non-zero winding rule
    let mut path = triangle.to_flattened_non_zero_edge(ShapeId::new());
    path.prepare_to_render();

    // Intercepts along the very bottom of the path
    let mut intercepts = vec![smallvec![]];
    path.intercepts(&[799.9999999999999], &mut intercepts);

    assert!(intercepts[0].len() == 2, "Should be 2 intercepts, found {:?}", intercepts[0]);
    assert!(intercepts[0][0].direction != intercepts[0][1].direction, "Intercept directions should invert (found {:?})", intercepts[0]);
}

/*
#[test]
pub fn triangle_lower_edge_non_zero_very_close_translated() {
    // Create a triangle subpath
    let triangle = BezierPathBuilder::<BezierSubpath>::start(Coord2(200.0, 200.0))
        .line_to(Coord2(800.0, 200.0))
        .line_to(Coord2(500.0, 800.0))
        .line_to(Coord2(200.0, 200.0))
        .build();

    // Non-zero winding rule
    let path = triangle.to_non_zero_edge(ShapeId::new());
    let path = path.transform(&Transform2D::translate(10.0, 0.0));

    // Intercepts along the very bottom of the path
    let mut intercepts = vec![smallvec![]];
    path.intercepts(&[799.9999999999999], &mut intercepts);

    assert!(intercepts[0].len() == 2, "Should be 2 intercepts, found {:?}", intercepts[0]);
    assert!(intercepts[0][0].direction != intercepts[0][1].direction, "Intercept directions should invert (found {:?})", intercepts[0]);
}
*/

#[test]
pub fn triangle_lower_edge_flattened_non_zero_very_close_translated() {
    // Create a triangle subpath
    let triangle = BezierPathBuilder::<BezierSubpath>::start(Coord2(200.0, 200.0))
        .line_to(Coord2(800.0, 200.0))
        .line_to(Coord2(500.0, 800.0))
        .line_to(Coord2(200.0, 200.0))
        .build();

    // Non-zero winding rule
    let path = triangle.to_flattened_non_zero_edge(ShapeId::new());
    let path = path.transform(&Transform2D::translate(10.0, 0.0));

    // Intercepts along the very bottom of the path
    let mut intercepts = vec![smallvec![]];
    path.intercepts(&[799.9999999999999], &mut intercepts);

    assert!(intercepts[0].len() == 2, "Should be 2 intercepts, found {:?}", intercepts[0]);
    assert!(intercepts[0][0].direction != intercepts[0][1].direction, "Intercept directions should invert (found {:?})", intercepts[0]);
}
